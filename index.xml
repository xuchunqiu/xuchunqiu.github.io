<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>CQCQ 收到未？</title><link>https://xuchunqiu.me/</link><description>欢迎来到我的菜园子</description><generator>Hugo -- gohugo.io</generator><managingEditor>xuchunqiu(#)st.xatu.edu.cn (xuchunqiu)</managingEditor><webMaster>xuchunqiu(#)st.xatu.edu.cn (xuchunqiu)</webMaster><lastBuildDate>Sun, 13 Nov 2022 07:22:59 +0000</lastBuildDate><atom:link href="https://xuchunqiu.me/index.xml" rel="self" type="application/rss+xml"/><item><title>近况更新·工作三个月之后</title><link>https://xuchunqiu.me/a-little-update-about-myself/</link><pubDate>Sun, 13 Nov 2022 07:22:59 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/a-little-update-about-myself/</guid><description><![CDATA[<p>这个博客之前放的都是之前在 notion 上记录的一些笔记，因为大师兄跟我讲说有一个技术博客对面试很加分，但其实面试的时候没有一个面试官跟我聊博客内容啊……总之现在也上班三个月了，是时候来水一篇生活记录了。</p>
<h2 id="工作">工作</h2>
<p>我入职的是广州黄埔区的一家生物初创公司的算法岗，入职两三天后赶上公司的开业典礼😂（其实公司是去年成立的，只是因为投资人的时间安排才拖到这个时间开）。工作时间的话是周一～周五早上 8:30 上班，中午 11:30 下班；
下午 13:00 上班，晚上 18:00 下班。住的地方步行到公司需要接近 30 分钟，以前会骑车上下班（12 分钟），但后来想多点运动所以这两周基本都是步行了，上下班步行 + 中午饭后散步差不多就能满足手表上 760 大卡的活动量
。</p>
<p>工作内容简单说就是用公司产出的数据训练预测模型。我们组的工作强度完全取决于上游给我们数据的速度，目前暂时是不加班的状态。但每天对着电脑 8 小时依然会让下班回家后眼睛特别累，所以午饭后我一般不午睡而是散步顺便放松
一下眼睛。</p>
<h2 id="生活">生活</h2>
<p>说起来是在广州但黄埔区这地方如果坐公共交通工具大概要一个小时多，基本是和以前从学校到市区的差不多的时间，加上我是一个不喜欢逛街的人，所以平时几乎不去市区。周末的休闲活动就是到处骑车。广州的公路骑行环境真是有够
糟糕的，几乎见不到单独的非机动车道，每次电动车、自行车都需要跟行人争路，在加上黄埔区这地方山多坡陡，骑起来实在不算享受。但不骑车我就失掉了唯一的周末运动量，所以还是在第一个月出粮后网上买了一辆硬尾山地车。</p>
<p>网上买车确实比线下门店更有性价比，但小问题还是挺多的比如蹭碟、变速滑档、坐垫太硬等，坑爹的是我推着新车去找出租屋附近的自行车修理店时老板拒绝了我，说你这个要到专门卖山地车的地方去修……无奈附近没有你说这种地方啊，
所以我被迫学会了调蹭碟、调变速，现在已经攒了一个工具箱出来（其实大部分放的是换下来的物件）。</p>
<p>广州用 Strava 的人还挺多的，可惜 GZcycle 俱乐部里面全是公路/Gravel 大佬，均速都 30 km/h 起步，而且团骑起点都离我很远。所以周末我一般就自己规划个 40~60 km 的圈松松腿。上个月咬咬牙买了个和自行车一样贵的
运动相机，如果有拍出好看的素材的话，未来在博客里发一下也说不定。</p>
]]></description></item><item><title>远程开发工具 JetBrains Gateway 初体验</title><link>https://xuchunqiu.me/jetbrains-gateway-first-experiences/</link><pubDate>Tue, 08 Mar 2022 01:37:19 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/jetbrains-gateway-first-experiences/</guid><description><![CDATA[<p>在去年写完 <a href="https://xuchunqiu.me/jetbrains-projector-first-experiences/" target="_blank" rel="noopener noreffer">Projector 的体验</a> 之后，我就已经没有再使用过它了，原因如下：</p>
<ul>
<li>必须安装客户端才能使用快捷键</li>
<li>服务端非本机部署时，必须在客户端主机上安装自签证书才能使用复制粘贴功能</li>
<li>因为网络传输不畅而不时遇到画质压缩，就只能等它连接稳定后再继续操作，使用体验不够连贯</li>
</ul>
<p>所以之后我又用回了通过 SSH 来部署代码和调用远程 Python 解释器的方法。去年年底，JetBrains 在其博客上发布了《<a href="https://blog.jetbrains.com/zh-hans/blog/2021/11/29/introducing-remote-development-for-jetbrains-ides/" target="_blank" rel="noopener noreffer">隆重推出 JetBrains IDE 的远程开发</a>》一文介绍了 <a href="https://www.jetbrains.com/zh-cn/remote-development/gateway/" target="_blank" rel="noopener noreffer">Gateway</a> 这一全新的远程开发工具。最近我终于有时间来安装体验一下 Gateway，本文就是对这一过程的简单回顾。</p>
<h2 id="0x00-前言">0x00 前言</h2>
<p>在开始之前必须强调的是，与 Projector 可以部署社区版 IDE 不同，要想通过 Gateway 连接到远程 IDE 则必须有对应的 IDE 订阅。我是通过学生 edu 邮箱获得的 JetBrains 全家桶订阅。</p>
<p>更多关于 Gateway 的常见问题可以参阅官方博文：《<a href="https://blog.jetbrains.com/zh-hans/blog/2021/12/03/dive-into-jetbrains-gateway/#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94" target="_blank" rel="noopener noreffer">深入了解 JetBrains Gateway</a>》</p>
<h2 id="0x01-下载与安装">0x01 下载与安装</h2>
<p>支持的操作系统：</p>
<ul>
<li>服务端：Linux（<a href="https://blog.jetbrains.com/zh-hans/blog/2021/12/03/dive-into-jetbrains-gateway/#:~:text=%E6%88%91%E4%BB%AC%E5%B0%86%E5%9C%A8%E6%9C%AA%E6%9D%A5%E6%B7%BB%E5%8A%A0%E5%AF%B9%20Windows%20%E5%92%8C%20macOS%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%94%AF%E6%8C%81" target="_blank" rel="noopener noreffer">未来会加入 Windows 和 macOS 的支持</a>）</li>
<li>客户端：Linux、Windows、macOS（intel）、macOS（Apple Silicon）</li>
</ul>
<p>与 Projector 不同，Gateway 服务端的安装完全通过客户端完成：<a href="https://www.jetbrains.com/zh-cn/remote-development/gateway/" target="_blank" rel="noopener noreffer">下载地址</a></p>
<p>目前下载到的应该都 <strong><ruby>抢先体验计划<rt>Early Access Programs</rt></ruby></strong> 的版本，截止本文写就时最新的版本是 <code>2022.1 Beta (221.5080.102)</code>，安装好后的主界面如下；</p>
<figure>
</figure>

<p>共有 SSH、JebBrains Space 和 共享链接 三种启动 Gateway 客户端的方式。区别如下：</p>
<ul>
<li>SSH：只要提供远程 Linux 主机的 SSH 连接信息即可，也是本文使用的方式</li>
<li>JetBrains Space：团队开发协作平台，有提供 <a href="https://www.jetbrains.com/space/buy/" target="_blank" rel="noopener noreffer">基础的免费方案</a></li>
<li>Code With Me 链接 / Gateway 链接：前者是用于结对编程的 IDE 插件，同样有 <a href="https://www.jetbrains.com/zh-cn/code-with-me/buy/#personal" target="_blank" rel="noopener noreffer">基础的免费方案</a>；后者的分享链接暂时还没有暴露出来，只有在连接到已有环境失败时才会显示出来</li>
</ul>
<p>接下来就选择 SSH，提供远程 Linux 主机的连接信息：</p>
<figure>
</figure>

<p>成功后就可以选择需要在远程主机上安装哪个 IDE 服务端（在 Gateway 中被称为 Backend）。当前有 IDEA、CLion、GoLand、PhpStorm、PyCharm、Rider、RubyMine 和 WebStorm 可选（EAP 的 Gateway 看到的 IDE 也都是 <strong><ruby>EAP<rt>Early Access Programs</rt></ruby></strong> 或 <strong><ruby>RC<rt>Release Candidate</rt></ruby></strong> 版），但都不提供社区版的选项：</p>
<figure>
</figure>

<p>默认是直接从互联网下载 IDE Backend 安装到远程主机的 <code>~/. cache/JetBrains/RemoteDev/dist</code>，也可以手动上传安装包和指定安装路径：</p>
<figure>
</figure>

<p>等待下载和安装过程完成，就会在本机自动打开 Gateway Client 了，与正常的 IDE 稍有区别的是多了一些连接状态的显示。整体上 Gateway 服务端的安装实在是比 Projector 省心太多。</p>
<figure>
</figure>

<h2 id="0x02-gateway-的使用感受">0x02 Gateway 的使用感受</h2>
<h3 id="优点">优点</h3>
<ol>
<li>比起在 <code>Settings</code>-<code>Tools</code>-<code>SSH Configurations</code> 添加 SSH 配置的远程开发方式，Gateway 不需要手动同步本地和远程代码（因为它的代码只保存在远程）、配置远程解释器。</li>
<li>比起 Projector 或是 VNC 方案，Gateway 画面永远不会糊。</li>
<li>剪贴板共享功能开箱即用。</li>
<li>支持将远程主机端口映射到本地。这个主要是因为我的远程主机是一个 Docker 环境，在创建好后就不能添加端口映射了，但 Gateway Client 的 <code>Settings</code>-<code>Tools</code>- <code>Port Forwarding</code> 里可以很方便地添加端口映射：
<figure>
</figure>
</li>
</ol>
<h3 id="缺点">缺点</h3>
<ol>
<li>有时需要复制两遍。当在 Gateway Client 中打开的文本内容先复制再粘贴时，有机率粘上的是之前一次复制的内容，不过只要 Gateway Client 再复制一次就没问题了。</li>
<li>没有考虑非英文输入的情况。这篇博文就是通过 Gateway 完成的，在使用拼音输入中文的过程中，我注意到当打字速度过快时就会有前后「吃字」的问题。这可能是因为 Gateway 对于输入的每个字母都是立即传输的，但当汉字上屏后光标位置的瞬间跳动没有被正确处理。</li>
<li>上传文件功能缺失。拖动本地文件到 Gateway Client 的文件树上并不会有任何反应，如果这时能自动通过 SFTP 协议上传就好了。</li>
</ol>
<h2 id="0x03-补充强制结束-ide-backend-的方法">0x03 补充：强制结束 IDE Backend 的方法</h2>
<p>因为目前还处在 EAP 阶段，稳定度还不算太高，有时会遇到 IDE Backend 旧进程卡死新进程启动不起来的窘境，目前 Gateway 也没有提供强制重启之类的功能，只能手动去 kill 相关进程。在 Gateway 的 <strong><ruby>最近 SSH 项目<rt>Recent SSH Projects</rt></ruby></strong> 页面有一个终端图标，点进去执行以下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# ps aux <span class="p">|</span> grep -i pycharm <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="m">738</span>
</span></span><span class="line"><span class="cl"><span class="m">743</span>
</span></span><span class="line"><span class="cl"><span class="m">861</span>
</span></span><span class="line"><span class="cl"><span class="m">876</span>
</span></span><span class="line"><span class="cl"><span class="m">1138</span>
</span></span><span class="line"><span class="cl"><span class="m">2880</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 把以上所有进程号都杀掉</span>
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">kill</span> <span class="m">738</span>
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>JetBrains Projector 使用初体验</title><link>https://xuchunqiu.me/jetbrains-projector-first-experiences/</link><pubDate>Tue, 06 Jul 2021 10:22:06 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/jetbrains-projector-first-experiences/</guid><description><![CDATA[<p>Projector 是 JetBrains 新推出的远程开发解决方案。实现上是在远程主机上部署 IDE 服务端然后在本地浏览器中或本地客户端中访问，本文记录了安装步骤和使用体验。</p>
<h2 id="0x00-可能有用的链接">0x00 可能有用的链接</h2>
<ol>
<li>官方博客介绍：<a href="https://blog.jetbrains.com/zh-hans/blog/2021/03/25/projector-ide/" target="_blank" rel="noopener noreffer">使用 Projector 远程访问 IDE</a></li>
<li>官方文档：<a href="https://jetbrains.github.io/projector-client/mkdocs/latest/" target="_blank" rel="noopener noreffer">Projector documentation</a></li>
<li>安装方式 A（命令行）：<a href="https://github.com/JetBrains/projector-installer" target="_blank" rel="noopener noreffer">JetBrains/projector-installer</a></li>
<li>安装方式 B（docker）：<a href="https://github.com/JetBrains/projector-docker" target="_blank" rel="noopener noreffer">JetBrains/projector-docker</a></li>
<li>Win/macOS/Linux 客户端下载：<a href="https://github.com/JetBrains/projector-client/releases/tag/launcher-v1.0.1" target="_blank" rel="noopener noreffer">releases on JetBrains/projector-client</a></li>
</ol>
<h2 id="0x01-安装步骤">0x01 安装步骤</h2>
<p>本文是采用上面的安装方式 A 在运行 Ubuntu 18.04 的远程主机上运行，具体步骤直接参考链接 3。命令抄录如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># install python3</span>
</span></span><span class="line"><span class="cl">user@machine:~# sudo apt install python3 python3-pip -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check pip3 version</span>
</span></span><span class="line"><span class="cl">user@machine:~# pip3 --version
</span></span><span class="line"><span class="cl"><span class="c1"># if pip3 &lt; 19</span>
</span></span><span class="line"><span class="cl">user@machine:~# python3 -m pip install -U pip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># install other packages</span>
</span></span><span class="line"><span class="cl">user@machine:~# sudo apt install libxext6 libxrender1 libxtst6 libfreetype6 libxi6 less -y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># install Jetrains Projector</span>
</span></span><span class="line"><span class="cl">user@machine:~# ip3 install projector-installer --user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># use Projector to install IDE</span>
</span></span><span class="line"><span class="cl">user@machine:~# projector install
</span></span><span class="line"><span class="cl">Checking <span class="k">for</span> updates ... <span class="k">done</span>.
</span></span><span class="line"><span class="cl">Installing IDE in quick mode<span class="p">;</span> <span class="k">for</span> full customization you can rerun this <span class="nb">command</span> with <span class="s2">&#34;--expert&#34;</span> argument or edit this config later via <span class="s2">&#34;projector config edit&#34;</span> command.
</span></span><span class="line"><span class="cl">           1. Idea_Community
</span></span><span class="line"><span class="cl">           2. Idea_Ultimate
</span></span><span class="line"><span class="cl">           3. PyCharm_Community
</span></span><span class="line"><span class="cl">           4. PyCharm_Professional
</span></span><span class="line"><span class="cl">           5. CLion
</span></span><span class="line"><span class="cl">           6. GoLand
</span></span><span class="line"><span class="cl">           7. DataGrip
</span></span><span class="line"><span class="cl">           8. PhpStorm
</span></span><span class="line"><span class="cl">           9. WebStorm
</span></span><span class="line"><span class="cl">          10. RubyMine
</span></span><span class="line"><span class="cl">          11. Rider
</span></span><span class="line"><span class="cl">Choose IDE <span class="nb">type</span> or <span class="m">0</span> to exit: <span class="o">[</span>0-11<span class="o">]</span>: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Do you want to <span class="k">select</span> from Projector-tested IDE only? <span class="o">[</span>y/N<span class="o">]</span>y
</span></span><span class="line"><span class="cl">           1. PyCharm Professional 2019.3.4
</span></span><span class="line"><span class="cl">           2. PyCharm Professional 2020.2
</span></span><span class="line"><span class="cl">           3. PyCharm Professional 2020.3.3
</span></span><span class="line"><span class="cl">Choose IDE number to install or <span class="m">0</span> to exit: <span class="o">[</span>0-3<span class="o">]</span>: <span class="m">3</span>
</span></span><span class="line"><span class="cl">Installing PyCharm Professional 2020.3.3
</span></span><span class="line"><span class="cl">Downloading pycharm-professional-2020.3.3.tar.gz
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">##------------------------------------------------]    4%  00:04:15</span>
</span></span><span class="line"><span class="cl">Unpacking pycharm-professional-2020.3.3.tar.gz
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="c1">##################################################]  100%          </span>
</span></span><span class="line"><span class="cl">Configuration name: PyCharm
</span></span><span class="line"><span class="cl">Checking <span class="k">for</span> updates ... <span class="k">done</span>.
</span></span><span class="line"><span class="cl">To access IDE, open in browser 
</span></span><span class="line"><span class="cl">        http://localhost:9999/
</span></span><span class="line"><span class="cl">        http://127.0.0.1:9999/
</span></span><span class="line"><span class="cl">        http://10.106.200.224:9999/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To see Projector logs in realtime run
</span></span><span class="line"><span class="cl">        tail -f <span class="s2">&#34;/root/.projector/configs/PyCharm/projector.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Exit IDE or press Ctrl+C to stop Projector.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># start IDE</span>
</span></span><span class="line"><span class="cl">user@machine:~# projector run
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中我遇到的坑主要是需要升级 pip3（&gt;= 19）和 Python（&gt;= 3.6），解决方案见下一章。</p>
<h2 id="0x02-故障排除">0x02 故障排除</h2>
<h3 id="更新完-pip3-后得到-syntaxerror-invalid-syntax">更新完 pip3 后得到 <code>SyntaxError: invalid syntax</code></h3>
<p>首先按照链接 3 的教程更新 pip3 到最新版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查现有 pip3 版本</span>
</span></span><span class="line"><span class="cl">pip3 --version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 如果版本小于 19 就使用如下命令更新到最新版本</span>
</span></span><span class="line"><span class="cl">python3 -m pip install -U pip
</span></span></code></pre></td></tr></table>
</div>
</div><p>再接着执行任何 <code>pip3 install</code> 都会得到如下错误：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sys.stderr.write<span class="o">(</span>f<span class="s2">&#34;ERROR: {exc}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                                   ^
</span></span><span class="line"><span class="cl">SyntaxError: invalid syntax
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个问题出现的原因是远程主机 Python = 3.5，但 pip 默认更新到最新的 pip 21.0 仅支持 Python 3.6+<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。我的选择是将 pip 更新到最后支持 Python 3.5 的那一版：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -fsSL -o- https://bootstrap.pypa.io/pip/3.5/get-pip.py <span class="p">|</span> python3.5
</span></span></code></pre></td></tr></table>
</div>
</div><p>这就为接下来的问题埋下伏笔。现在回想此时正确的做法应是直接更新 Python。</p>
<h3 id="尝试用-pip3-安装-projector-时遇到-error">尝试用 pip3 安装 Projector 时遇到 <code>Error</code></h3>
<p>在按照链接 3 的教程安装完一系列的依赖后，就可以正式安装 Projector：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip3 install projector-installer --user
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR: Could not find a version that satisfies the requirement projector-installer
</span></span><span class="line"><span class="cl">ERROR: No matching distribution found <span class="k">for</span> projector-installer
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果遇到以上错误，说明需要升级 Python 版本<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>。教程见<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>，摘录如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo add-apt-repository ppa:deadsnakes/ppa
</span></span><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install python3.8
</span></span><span class="line"><span class="cl">sudo apt install python3.8-distutils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新软链接</span>
</span></span><span class="line"><span class="cl">sudo rm /usr/bin/python3
</span></span><span class="line"><span class="cl">sudo ln -s python3.8 /usr/bin/python3
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="projector-命令无效"><code>projector</code> 命令无效</h3>
<p>这个问题在链接 3 的 FAQ 部分已经进行了说明<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>。是出在 <code>projector</code> 的安装路径 <code>~/.local/bin</code> 没有加入到环境变量 <code>$PATH</code> 中，直接的 workaround 是使用完整路径启动 <code>projector</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">~/.local/bin/projector
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过一劳永逸的方法将添加环境变量 <code>$PATH</code> 的命令写入到 <code>~/.profile</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;export PATH=</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">:~/.local/bin&#34;</span> &gt;&gt; ~/.profile
</span></span><span class="line"><span class="cl">. ~/.profile
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="projector-run-尝试启动-ide-后很快出现报错日志"><code>projector run</code> 尝试启动 IDE 后很快出现报错日志</h3>
<p>在初次使用 <code>projector install</code> 完成 IDE 安装后会自动启动 IDE，使用完毕后使用 <code>Ctrl</code> + <code>c</code> 退出。之后想再次启动已经安装好的 IDE 就需要使用 <code>projector run</code> 命令，可能遇到在输出完 IDE 的访问链接后立刻打印报错日志的情况：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Checking <span class="k">for</span> updates ... <span class="k">done</span>.
</span></span><span class="line"><span class="cl">To access IDE, open in browser 
</span></span><span class="line"><span class="cl">        http://localhost:9999/
</span></span><span class="line"><span class="cl">        http://127.0.0.1:9999/
</span></span><span class="line"><span class="cl">        http://10.106.200.224:9999/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To see Projector logs in realtime run
</span></span><span class="line"><span class="cl">        tail -f <span class="s2">&#34;/root/.projector/configs/PyCharm/projector.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Exit IDE or press Ctrl+C to stop Projector.
</span></span><span class="line"><span class="cl">--------------------- Projector log session start. Installer version: 1.1.1 Run config: PyCharm - 2021-04-07 08:02:35.367158
</span></span><span class="line"><span class="cl">OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: IdeState :: Starting attempts to attach IJ injector agent
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: IdeState :: Starting attempts to initialize IDEA: fix AA and disable smooth scrolling <span class="o">(</span>at start<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> :: ProjectorServer :: ProjectorServer is starting on host 0.0.0.0/0.0.0.0 and port <span class="m">9999</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: IdeState :: Starting attempts to Getting IDE colors
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> :: ProjectorServer :: WebSocket SSL is disabled
</span></span><span class="line"><span class="cl"><span class="o">[</span>INFO<span class="o">]</span> :: ProjectorServer :: Server started on host 0.0.0.0/0.0.0.0 and port <span class="m">9999</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: ProjectorServer :: Daemon thread starts
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: IdeState :: Starting attempts to search <span class="k">for</span> editors
</span></span><span class="line"><span class="cl">IDE has not been initialized yet
</span></span><span class="line"><span class="cl"><span class="o">[</span>DEBUG<span class="o">]</span> :: ProjectorServer :: Daemon thread finishes
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个问题可能是之前的 IDE 没有成功退出导致的<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>（虽然 log 看起来并非如此），杀掉旧进程就可以了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@machine:~# ps aux <span class="p">|</span> grep -i pycharm
</span></span><span class="line"><span class="cl">root       <span class="m">966</span> 36.5  0.2 <span class="m">8513048</span> <span class="m">286408</span> pts/0  Sl   07:38   9:51 /root/.projector/apps/pycharm-2020.3.3/jbr/bin/java -classpath /r
</span></span><span class="line"><span class="cl">root      <span class="m">2102</span>  0.0  0.0  <span class="m">13216</span>  <span class="m">1064</span> pts/0    S+   08:05   0:00 grep --color<span class="o">=</span>auto -i pycharm
</span></span><span class="line"><span class="cl">root@machine:~# <span class="nb">kill</span> <span class="m">966</span>
</span></span><span class="line"><span class="cl">root@machine:~# ps aux <span class="p">|</span> grep -i pycharm
</span></span><span class="line"><span class="cl">root      <span class="m">2113</span>  0.0  0.0  <span class="m">13216</span>  <span class="m">1044</span> pts/0    S+   08:06   0:00 grep --color<span class="o">=</span>auto -i pycharm
</span></span><span class="line"><span class="cl">root@machine:~# projector run
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x03-存在的问题">0x03 存在的问题</h2>
<p>此处仅列举我在实际体验中觉得很糟心的地方，其它问题可以在链接 2 的 Known problems<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup> 部分查看。</p>
<h3 id="快捷键冲突和剪贴板共享">快捷键冲突和剪贴板共享</h3>
<p>Projector 的服务端是安装在远程 Linux 环境中，然后通过本地浏览器或下载链接 5 的客户端使用（这里需要提一句的是 JetBrains 的 IDE 插件市场中也上架了 <code>Projector</code><sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>，但这个是把本机 IDE 当服务端来用的）。</p>
<p>当通过浏览器访问 Projector 时，IDE 的快捷键会与浏览器本身的快捷键冲突，例如选择代码块的快捷键 <code>Ctrl</code> + <code>w</code><sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>在 Chromium/Firefox/Safari 中是关闭当前标签页。所以为了使用快捷键还有复制粘贴功能，最好还是下载独立的 Projector 客户端。</p>
<h3 id="启用自签证书的-https">启用自签证书的 HTTPS</h3>
<p>本文初次写成于 2021 年 3 月，但当 4 月我在另一台机器上部署完 Projector 后发现即使用 Projector 客户端去连也不能将其中的文本复制粘贴到其它程序中。在 JetBrains 的 bug 跟踪系统 YouTrack 上有人<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>解释是新版本的服务端后只有在 localhost 部署或启用 HTTPS 后才能跨程序复制粘贴，同时给出了对于 <a href="https://jetbrains.github.io/projector-client/mkdocs/latest/ij_user_guide/accessing/#incomplete-clipboard-synchronization" target="_blank" rel="noopener noreffer">不完整剪贴板同步实现过程的官方文档</a>。</p>
<p>就个人+内网使用来说，自签 HTTPS 证书是比较简单的方式。此处给出自签证书的启用方法，至于使用可信任证书颁发机构给域名颁发的证书，可以参考链接 3 自述文件的 FAQ 部分<sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup>。</p>
<p>在命令行中交互式启动自签 HTTPS 证书：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 所有可用命令</span>
</span></span><span class="line"><span class="cl">projector config <span class="o">(</span>--help<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 列出所有配置的名称</span>
</span></span><span class="line"><span class="cl">projector config list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 展示选定配置的详情</span>
</span></span><span class="line"><span class="cl">projector config show
</span></span><span class="line"><span class="cl"><span class="c1"># 这里的信息要比 ~/.projector/configs/PyCharm/config.ini 更详细，</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 也有一个布尔的 &#34;Projector uses secure config (https/wss)= 0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 交互式修改配置</span>
</span></span><span class="line"><span class="cl">projector config edit
</span></span><span class="line"><span class="cl"><span class="c1"># 只需给 Use secure connection? 一个 y 的回答</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改完毕后再 <code>projector run</code> 就能看到终端中提示要从 <code>~/.projector/ssl/ca.crt</code> 安装证书，有意思的是这个证书下载下来是 0KB，无法安装。我最后是通过直接在 Chrome 访问 <code>https://&lt;projector-server-address&gt;:&lt;projector-port&gt;</code> -&gt; 导出证书 -&gt; 文件管理器安装。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://stackoverflow.com/questions/65869296/installing-pip-is-not-working-in-python-3-6" target="_blank" rel="noopener noreffer">https://stackoverflow.com/questions/65869296/installing-pip-is-not-working-in-python-3-6</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://youtrack.jetbrains.com/issue/PRJ-302" target="_blank" rel="noopener noreffer">https://youtrack.jetbrains.com/issue/PRJ-302</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p><a href="https://stackoverflow.com/questions/58591889/how-i-can-upgrade-my-ubuntu-python3-7-to-python3-8-latest-version" target="_blank" rel="noopener noreffer">https://stackoverflow.com/questions/58591889/how-i-can-upgrade-my-ubuntu-python3-7-to-python3-8-latest-version</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p><a href="https://github.com/JetBrains/projector-installer#projector-command-is-unavailable" target="_blank" rel="noopener noreffer">https://github.com/JetBrains/projector-installer#projector-command-is-unavailable</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p><a href="https://stackoverflow.com/questions/61236544/clion-pycharm-phpstorm-intellij-wont-start-says-ide-has-not-been-initialized/61237140#61237140" target="_blank" rel="noopener noreffer">https://stackoverflow.com/questions/61236544/clion-pycharm-phpstorm-intellij-wont-start-says-ide-has-not-been-initialized/61237140#61237140</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p><a href="https://jetbrains.github.io/projector-client/mkdocs/latest/ij_user_guide/jetbrains/#known-problems" target="_blank" rel="noopener noreffer">https://jetbrains.github.io/projector-client/mkdocs/latest/ij_user_guide/jetbrains/#known-problems</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p><a href="https://plugins.jetbrains.com/plugin/16015-projector" target="_blank" rel="noopener noreffer">https://plugins.jetbrains.com/plugin/16015-projector</a>&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p><a href="https://www.jetbrains.com/help/idea/working-with-source-code.html#editor_code_selection" target="_blank" rel="noopener noreffer">https://www.jetbrains.com/help/idea/working-with-source-code.html#editor_code_selection</a>&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p><a href="https://youtrack.jetbrains.com/issue/PRJ-426#focus=Comments-27-4816576.0-0" target="_blank" rel="noopener noreffer">https://youtrack.jetbrains.com/issue/PRJ-426#focus=Comments-27-4816576.0-0</a>&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10" role="doc-endnote">
<p><a href="https://github.com/JetBrains/projector-installer#secure-connection" target="_blank" rel="noopener noreffer">https://github.com/JetBrains/projector-installer#secure-connection</a>&#160;<a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description></item><item><title>什么是 SCI</title><link>https://xuchunqiu.me/what-is-sci/</link><pubDate>Wed, 11 Nov 2020 10:29:37 +0800</pubDate><author>Author</author><guid>https://xuchunqiu.me/what-is-sci/</guid><description><![CDATA[<div class="featured-image">
                <img src="https://raw.githubusercontent.com/xuchunqiu/personal-blog-resources/main/posts/2020-11-11/2020-11-11-001.png" referrerpolicy="no-referrer">
            </div><h1 id="影响因子">影响因子</h1>
<blockquote>
<p>Impact Factor</p>
</blockquote>
<p>是美国科学情报研究所（ISI）的 <a href="https://zh.wikipedia.org/wiki/%e6%9c%9f%e5%88%8a%e5%bc%95%e8%af%81%e6%8a%a5%e5%91%8a" target="_blank" rel="noopener noreffer">期刊引证报告</a>（JCR）中的一项数据。指的是某一期刊的文章在特定年份或时期被引用的频率，是衡量 <a href="https://zh.wikipedia.org/wiki/%e5%ad%a6%e6%9c%af%e6%9c%9f%e5%88%8a" target="_blank" rel="noopener noreffer">学术期刊</a> 影响力的一个重要指标。由美国科学情报研究所创始人尤金·加菲得在 1960 年代创立，其后为 <a href="https://zh.wikipedia.org/wiki/%e6%96%87%e7%8c%ae%e8%ae%a1%e9%87%8f%e5%ad%a6" target="_blank" rel="noopener noreffer">文献计量学</a> 的发展带来了一系列重大革新。</p>
<p>自 1975 年以来，每年定期发布于《<a href="https://clarivate.com/webofsciencegroup/zh-hans/solutions/journal-citation-reports/" target="_blank" rel="noopener noreffer">期刊引证报告</a>》（JCR）。</p>
<p>影响指数即某期刊前两年（S, T）发表的论文在统计当年（U）的被引用总次数 X（前两年总被引次数）<strong>除以</strong>该期刊在前两年（S, T）内发表的论文总数 Y（前两年总发文量）。这是一个国际上通行的期刊评价指标。公式为：</p>
<p>$$I F_{U}=\frac{X_{(S, T)}}{Y_{(S, T)}}$$</p>
<h1 id="sci-科学引文索引">SCI 科学引文索引</h1>
<blockquote>
<p>Science Citation Index</p>
</blockquote>
<p>是由美国 <a href="https://zh.wikipedia.org/w/index.php?title=%e7%a7%91%e5%ad%a6%e8%b3%87%e8%a8%8a%e7%a0%94%e7%a9%b6%e6%89%80&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreffer">科学资讯研究所</a>（Institute for Scientific Information，简称ISI）于 1960 年上线投入使用的一部期刊文献检索工具（<a href="https://mjl.clarivate.com/home" target="_blank" rel="noopener noreffer">点我使用</a>），其出版形式包括印刷版期刊和光盘版及联机数据库。科学引文索引由 <a href="https://clarivate.com.tw/" target="_blank" rel="noopener noreffer">科睿唯安</a> 公司（Clarivate Analytics）运营。</p>
<p>收录范围：自然科学的基础研究领域</p>
<h2 id="web-of-science">Web of Science™</h2>
<blockquote>
<p>科睿唯安当前涉及的领域包括：科学与学术研究、生命科学与制药、专利与研发创新、产业法规与标准、网域名称管理、商标检索与保护。Web of Science™ 是其在 科学与学术研究 领域提供的「最受信任的、独立于出版商的全球引文数据库（the world’s most trusted publisher-independent global citation database）」；而 Journal Citation Reports 是其在 科学与学术研究 领域 依托于 Web of Science 的在研究分析与评估方面的产品。它早先的名称是 Web of Knowledge</p>
</blockquote>
<p>Web of Science™ 是一个基于 Web 而构建的动态的数字研究环境，通过强大的检索技术和基于内容的连接能力，将高质量的信息资源、独特的信息分析工具和专业的信息管理软件无缝地整合在一起，兼具知识的检索、提取、分析、评价、管理与发表等多项功能<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。在内容上，</p>
<ul>
<li>以 Web of Science™ 核心合集（著名的三大引文索引 Science Citation Index Expanded®, Social Science Citation Index®, Arts &amp; Humanities Citation Index®）为核心</li>
</ul>
<p>，凭藉独特的引文检索机制和强大的交叉检索功能，有效地整合了：</p>
<ul>
<li>学术期刊（Web of Science™ 核心合集）</li>
<li>技术专利（Derwent Innovations Index）</li>
<li>化学反应（Chemistry）</li>
<li>研究基金（eSearch）</li>
<li>Internet资源（Current Web Contents）</li>
<li>学术分析与评价工具（Essential Science Indicators）</li>
<li>学术社区（<a href="http://HighlyCited.com" target="_blank" rel="noopener noreffer">HighlyCited.com</a>）</li>
</ul>
<p>及其它重要的学术信息资源，提供了自然科学、工程技术、生物医学、社会科学、艺术与人文等多个领域中高质量、可信赖的学术信息。Web of Science™ 平台上所有数据库中的信息都是经过精心挑选的，它只收录那些对研究者有用的出版物、网站内容和其它学术资源。这些学术信息是由许多不同的媒介以不同的格式提供的。这些媒介形式包括期刊（印刷版或电子版）、书籍和会议录、网站内容，以及 ISI 外部的数据库。</p>
<h3 id="web-of-science-core-collection-核心合辑2">Web of Science Core Collection™ 核心合辑<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></h3>
<blockquote>
<p>遴选标准：<a href="https://solutions.clarivate.com.cn/products/web-of-science%e6%a0%b8%e5%bf%83%e5%90%88%e9%9b%86%e9%81%b4%e9%80%89%e6%a0%87%e5%87%86/" target="_blank" rel="noopener noreffer">zh-cn</a>、<a href="https://clarivate.com.tw/products/web-of-science/journal-selection-process/" target="_blank" rel="noopener noreffer">zh-tw</a></p>
<p>重点摘录：普通期刊 →（编辑品质评估成功）→ ESCI →（编辑影响力评估成功）→ SCIE/SSCI/AHCI，其中箭头也可反向——即SCIE也可掉回ESCI甚至普通期刊</p>
</blockquote>
<p>拥有来自全球 18,000 多种高影响力的学术期刊、180,000 多种会议论文、以及 80,000 多种学术书籍的多学科研究资料。通过百年以上的丰富文献资源以及超过十亿的引文网络，您可以在任何领域放心地检索并发现完整的引文网络。</p>
<ul>
<li>
<p><strong>Science Citation Index Expanded™ (SCIE)</strong></p>
<p>涵盖 178 个学科的 9300 多种主流期刊。— 1900 年至今。</p>
</li>
<li>
<p><strong>Social Sciences Citation Index™ (SSCI)</strong></p>
<p>涵盖 58 个社会科学学科的 3,400 多种期刊，以及从 3,500 种世界顶尖期刊中筛选的内容。— 1900 年至今。</p>
</li>
<li>
<p><strong>Arts &amp; Humanities Citation Index™ (A&amp;HCI)</strong></p>
<p>超过 1,800 种艺术与人文领域的期刊，以及从 250 多种自然科学和社会科学期刊中筛选的内容。— 1975 年至今。</p>
</li>
<li>
<p>Emerging Sources Citation Index™ (ESCI)</p>
<p>包含了 5,000 多种期刊的 ESCI，旨在捕捉高影响力文献之外的自然科学、社会科学和人文学科领域的趋势与发展。科睿唯安编辑团队所遴选并评审的期刊通常会在全球得到相关领域的意见领袖、基金资助和评估机构的重视。</p>
</li>
<li>
<p>Book Citation Index™ (BKCI)</p>
<p>索引了超过 80,000 种编辑精选的图书，且每年增加 10,000 种新书。— 2005 年至今。</p>
</li>
<li>
<p>Conference Proceedings Citation Index (CPCI)</p>
<p>该多学科索引能让人们以最快的方式从 180,000 多种会议论文集中获得最前沿、有影响力的研究。— 1990 年至今。</p>
</li>
</ul>
<h3 id="区域性资料库3">区域性资料库<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></h3>
<ul>
<li>
<p>Chinese Science Citation Database™（中国科学引文资料库）</p>
<p>科睿唯安与中国科学院合作，将中国科学引文资料库（Chinese Science Citation Database™）嵌入到 Web of Science™ 平台中，让全世界更多的科学研究人员瞭解中国的科学研究发展及动态。作为 Web of Science™ 平台中首个非英文产品，该资料库收录了约 1,100 种中国出版的科学与工程核心期刊，共有近 400 万条论文记录，1,700 万条引文记录。</p>
</li>
<li>
<p>Russian Science Citation Index™</p>
</li>
<li>
<p>KCI Korean Journal Database™</p>
</li>
<li>
<p>SciELO Citation Index™</p>
</li>
</ul>
<h2 id="journal-citation-reports-期刊引证报告4">Journal Citation Reports™ 期刊引证报告<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></h2>
<p>全球每年有上千万的学术研究著作发表，其中的文献引用更是巨量。引文所串起的连结都具有意义，因为这是研究学者悉心阐述其研究发现的轨迹，而每一本他们所引用与选择的期刊也代表著他们重视该期刊为自己的研究发现所带来的价值。Journal Citation Reports™ (JCR) 汇总了 Web of Science™ 核心合辑期刊的引文数据，呈现了庞大的学术网络彼此之间的关联与研究脉络。</p>
<p>最新版的 JCR 显著加强了对 Journal Impact Factor™ (JIF) 和其他指标的透明度，增加了论文层面的分析和解读，为用户全面瞭解期刊表现，提供了新的分析角度和更加丰富而详尽的资讯。这些新的分析角度更好地利用了引文资料库中的资料和指标，能协助研究人员、出版商、期刊编辑、图书馆员和基金资助者进一步地瞭解期刊对各种用户的核心价值。</p>
<p>每本被 JCR 收录的期刊均符合 Web of Science 核心合辑的期刊遴选标准，JCR仅显示被 Science Citation Index Expanded™ (SCIE) 和 Social Sciences Citation Index™ (SSCI) 索引的期刊，以便您可以快速找到自然科学和社会科学领域最具影响力的期刊清单。</p>
<h3 id="指标5">指标<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></h3>
<p>期刊引证报告透过量化引用文献的统计资讯，于每年度发表下列评比指标并予以排名：</p>
<ol>
<li>年度影响因子（Impact Factor）：透过该期刊“前两年”所发表文章总数，与“前两年”的文章在“该年度”被引用的总次数计算而得出。当影响因子的数字越高，代表此期刊的文章被引用次数越多，即此期刊在学术界的影响力越大。一般而言期刊的影响因子越高，则代表此期刊的学术品质越佳。值得注意的是，影响因子虽然是期刊本身评价的指标，但不能作为该期刊中单篇论文影响力的依据、或是论文作者的评价。</li>
<li>5年影响因子（5-Year Impact Factor）：透过该期刊于“前五年”所发表文章总数，与“前五年”的文章在“该年度”被引用的总次数计算而得出。此指标类似于年度影响因子，但计算时间较长，可以代表该期刊在长时间下的影响能力。</li>
<li>立即指数（Immediacy Index）：为该期刊当年度所出版文章的平均被引用次数。此指标可代表该期刊在当年度影响力的大小。</li>
<li>被引半衰期（Cited Half-Life）：该期刊的总被引用次数衰退一半所需要的年数（此数据只有在总被引次数大于100时提供）。此指标可代表该期刊文章影响力衰退的速度，其数值越大则代表影响力持续较久，数值越小则代表影响力较小。通常社会科学领域期刊的被引用半衰期相较来的长。</li>
<li>总被引用次数（Total Cites）：为该期刊自从被收录进期刊引证报告后的总被引用次数。</li>
<li>文章总数（Current Articles）：为该期刊自从被收录进期刊引证报告后的文章总数。</li>
</ol>
<h1 id="engineering-index-工程索引">Engineering Index 工程索引</h1>
<p>是世界著名的检索工具，由美国工程信息公司编辑出版发行，该公司始建于 1884 年，是世界上最大的工程信息提供者之一，早期出版印刷版、缩微版等信息产品，1969 年开始提供 EI Compendex 数据库服务。EI Compendex：对应的印刷版检索刊为《工程索引》，是最常用的文摘数据库之一，侧重于工程技术领域的文献的报道。1992 年开始收录中国期刊，1998 年清华大学建立了 EI 中国镜像站。</p>
<p>EI数据来源于 3 千种工程类期刊以及 9 万多种会议录，每周更新<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>。目前主要有三个版本：</p>
<ul>
<li>Ei Compendex 光盘数据库</li>
<li>Ei Compendex Web数据库</li>
<li>Engineering Village 2 工程信息村</li>
</ul>
<p>其中 Ei Village 2 包括：</p>
<ul>
<li>Compendex</li>
<li>Engineering Index Backfile 工程索引回放文件</li>
<li>Inspec</li>
<li>Inspec Archive</li>
<li>NTIS 国家医学研究所</li>
<li>Referex Engineering</li>
<li>ENGnetBASE</li>
<li>Patents from USPTO and esp@cenet</li>
<li>GlobalSpec</li>
<li>Scirus</li>
<li>EEVL</li>
<li>LexisNexis News</li>
</ul>
<h1 id="参考文献">参考文献</h1>
<p><a href="http://tul.blog.ntu.edu.tw/archives/4797" target="_blank" rel="noopener noreffer">Impact Factor、引用次數與學術評鑑相關問題懶人包</a></p>
<p><a href="http://tul.blog.ntu.edu.tw/archives/8330" target="_blank" rel="noopener noreffer">WoS 與 WOK、JCR、ESI 之間的關係？</a>：</p>
<p></p>
<p><a href="http://tul.blog.ntu.edu.tw/archives/8333" target="_blank" rel="noopener noreffer">SCI 與 SCIE 的區別</a>：1. SCI为光盘形式，现已停止发行发布；后者为网页服务 2. 两者评选标准相同</p>
<p><a href="http://tul.blog.ntu.edu.tw/archives/2598" target="_blank" rel="noopener noreffer">如何得知期刊是否收錄於 Web of Science 資料庫？</a>：<a href="https://mjl.clarivate.com/home" target="_blank" rel="noopener noreffer">WOS’s Master Journal List</a></p>
<p><a href="http://tul.blog.ntu.edu.tw/archives/4627" target="_blank" rel="noopener noreffer">如何得知某期刊是否被EI收錄？</a>：<a href="https://www.engineeringvillage.com/search/quick.url" target="_blank" rel="noopener noreffer">Ei Village(Source title)</a> or 下载（定期更新的）<a href="https://www.elsevier.com/solutions/engineering-village/content/compendex" target="_blank" rel="noopener noreffer">Ei Compendex 收录清单</a></p>
<p><a href="http://tul.blog.ntu.edu.tw/archives/1831" target="_blank" rel="noopener noreffer">如何查詢期刊之Impact Factor</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://solutions.clarivate.com.cn/products/web-of-science%E6%A0%B8%E5%BF%83%E5%90%88%E9%9B%86%E9%81%B4%E9%80%89%E6%A0%87%E5%87%86/" target="_blank" rel="noopener noreffer">科睿唯安网站上关于 Web of Science™ 核心合集的遴选标准</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://clarivate.com.tw/products/web-of-science/databases" target="_blank" rel="noopener noreffer">科睿唯安网站上关于 Web of Science™ 核心合辑的介绍</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p><a href="https://clarivate.com.tw/products/web-of-science/databases#standard-text-3:~:text=%e5%8d%80%e5%9f%9f%e6%80%a7%e8%b3%87%e6%96%99%e5%ba%ab" target="_blank" rel="noopener noreffer">科睿唯安网站上关于 Web of Science™ 核心合辑中区域性资料库的介绍</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p><a href="https://clarivate.com.tw/products/journal-citation-reports" target="_blank" rel="noopener noreffer">科睿唯安网站上关于期刊引证报告的介绍</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/%e6%9c%9f%e5%88%8a%e5%bc%95%e8%af%81%e6%8a%a5%e5%91%8a#%e6%8c%87%e6%a8%99:~:text=%e6%8c%87%e6%a0%87[%e7%bc%96%e8%be%91],%e6%9c%9f%e5%88%8a%e5%bc%95%e8%af%81%e6%8a%a5%e5%91%8a%e9%80%8f%e8%bf%87%e9%87%8f%e5%8c%96%e5%bc%95%e7%94%a8%e6%96%87%e7%8c%ae%e7%9a%84%e7%bb%9f%e8%ae%a1%e8%b5%84%e8%ae%af%ef%bc%8c%e4%ba%8e%e6%af%8f%e5%b9%b4%e5%ba%a6%e5%8f%91%e8%a1%a8%e4%b8%8b%e5%88%97%e8%af%84%e6%af%94%e6%8c%87%e6%a0%87%e5%b9%b6%e4%ba%88%e4%bb%a5%e6%8e%92%e5%90%8d%ef%bc%9a" target="_blank" rel="noopener noreffer">维基百科条目「期刊引证报告」中关于指标的解释</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p><a href="http://www.ei-cn.com/About/5.html" target="_blank" rel="noopener noreffer">第三方网站「EI学术」上对EI的简介</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></description></item><item><title>配置 OpenSSH 的公钥认证</title><link>https://xuchunqiu.me/use-public-key-authentication-in-openssh/</link><pubDate>Mon, 05 Oct 2020 03:41:14 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/use-public-key-authentication-in-openssh/</guid><description><![CDATA[<h2 id="0x00-前言">0x00 前言</h2>
<p><a href="https://www.ssh.com/ssh/" target="_blank" rel="noopener noreffer">https://www.ssh.com/ssh/</a> 上的文档写得很详细但有些散碎，本文对配置 OpenSSH 公钥认证的环节进行了整理。</p>
<p>如果你还不了解什么是公钥认证的话，可以看： <a href="https://www.ssh.com/ssh/public-key-authentication" target="_blank" rel="noopener noreffer">https://www.ssh.com/ssh/public-key-authentication</a></p>
<h3 id="公私钥长什么样">公私钥长什么样？</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># https://www.ssh.com/ssh/key/#what-do-ssh-keys-look-like:~:text=An%20authorized%20key%20can%20look%20like%20this%3A</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 公钥 a.k.a. public key a.k.a. authorized key</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 尾部是生成密钥对的 &lt;用户名&gt;@&lt;主机名&gt;</span>
</span></span><span class="line"><span class="cl">ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBN+Mh3U/3We4VYtV1QmWUFIzFLTUeegl1Ao5/QGtCRGAZn8bxX9KlCrrWISIjSYAwCajIEGSPEZwPNMBoK8XD8Q<span class="o">=</span> ylo@klar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 私钥 a.k.a. private key a.k.a. identity key</span>
</span></span><span class="line"><span class="cl">-----BEGIN EC PRIVATE KEY-----
</span></span><span class="line"><span class="cl">MHcCAQEEIJWbvSW7h50HPwG+bWR3DXgQ6YhOxYbe0ifr1rRUvsUuoAoGCCqGSM49
</span></span><span class="line"><span class="cl">AwEHoUQDQgAE34yHdT/dZ7hVi1XVCZZQUjMUtNR56CXUCjn9Aa0JEYBmfxvFf0qU
</span></span><span class="line"><span class="cl"><span class="nv">KutYhIiNJgDAJqMgQZI8RnA80wGgrxcPxA</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">-----END EC PRIVATE KEY-----
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来本文将以 Windows 作为本机系统、Ubuntu 作为远程主机系统演示公钥认证的配置过程。</p>
<h2 id="0x01-本机使用-ssh-keygen-生成公私钥对">0x01 本机使用 <code>ssh-keygen</code> 生成公私钥对</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># PowerShell</span>
</span></span><span class="line"><span class="cl">ssh-keygen.exe
</span></span><span class="line"><span class="cl"><span class="c1"># 默认输出到 C:\Users\$ENV:USERNAME\.ssh\ 下的 id_rsa</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># WSL</span>
</span></span><span class="line"><span class="cl">ssh-keygen
</span></span><span class="line"><span class="cl"><span class="c1"># 默认输出到 ~/.ssh/ 下的 id_rsa</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>密码（passphrase）对私钥的加密效果使得第三方即使获得私钥也无法完成认证过程。</p>
<figure>
</figure>

<p>需要说明的是，在手动指定密钥对的保存路径时，如果只写文件名，默认是放在启动 <code>ssh-keygen</code> 时所在的工作目录中。</p>
<h2 id="0x02-将公钥内容写入远程主机的-sshauthorized_keys-文件中">0x02 将公钥内容写入远程主机的 <code>~/.ssh/authorized_keys</code> 文件中</h2>
<blockquote>
<p><code>authorized_keys</code> 文件保存允许通过公钥授权来经 SSH 登录服务器者的公钥，每行保存一个，空行或是井号会被忽略。</p>
<p>它通常位于 <code>~/.ssh/authorized_keys</code>（许多 OpenSSH 的版本也会使用 <code>~/ssh/authorized_keys2</code>），而对一些使用客制化 OpenSSH 构建的组织来说，这个默认路径可能有变化。</p>
<p><a href="https://www.ssh.com/ssh/authorized_keys/openssh" target="_blank" rel="noopener noreffer">Configuring authorized_keys for OpenSSH</a></p>
</blockquote>
<h3 id="方法-1使用-ssh-copy-id">方法 1：使用 <code>ssh-copy-id</code></h3>
<p><code>ssh-copy-id</code> 用于在远程主机上添加公钥，它的操作逻辑为：</p>
<ol>
<li>远程服主机的 <code>~/.ssh</code> 路径是否存在？创建：下一步</li>
<li>远程主机的 <code>~/.ssh/authorized_keys</code> 文件是否存在？创建：下一步</li>
<li>（当没有使用 <code>-f</code>(orce) 时）远程主机的 <code>authorized_keys</code> 文件是否已包含本次要配置的公钥？跳过：添加，下一步</li>
<li>远程主机的 <code>authorized_keys</code> 文件权限是否仅有当前用户可写入？不变：修改</li>
</ol>
<p>其可选参数为：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-f</code></td>
<td>Don&rsquo;t check if the key is already configured as an authorized key on the server. Just add it. This can result in multiple copies of the key in authorized_keys files.</td>
</tr>
<tr>
<td><code>-i</code></td>
<td>Specifies the identity file that is to be copied (default is ~/.ssh/id_rsa). If this option is not provided, this adds all keys listed by ssh-add -L. Note: it can be multiple keys and adding extra authorized keys can easily happen accidentally! If ssh-add -L returns no keys, then the most recently modified key matching ~/.ssh/id*.pub, excluding those matching ~/.ssh/*-cert.pub, will be used.</td>
</tr>
<tr>
<td><code>-n</code></td>
<td>Just print the key(s) that would be installed, without actually installing them.</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>Connect to the specifed SSH port on the server, instead of the default port 22.</td>
</tr>
<tr>
<td><code>-h</code></td>
<td>help</td>
</tr>
</tbody>
</table>
<p>关于 <code>ssh-copy-id</code> 的更多介绍见：<a href="https://www.ssh.com/ssh/copy-id" target="_blank" rel="noopener noreffer">ssh-copy-id for copying SSH keys to servers</a>，也可直接跳转到 <a href="https://www.ssh.com/ssh/copy-id#troubleshooting:~:text=key.-,Troubleshooting" target="_blank" rel="noopener noreffer">Trouble shooting</a> 章节</p>
<p>废话写完了，实际使用的命令如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh-copy-id -i /mnt/c/Users/<span class="nv">$ENV</span>:USERNAME/.ssh/keypair/keyToGPUServer amax@192.168.50.50
</span></span></code></pre></td></tr></table>
</div>
</div><figure>
</figure>

<p>可以注意到，已成功添加了一个公钥，但并不能按照提示所说直接使用 public key authentication，后续会在 # 0x03 的 <a href="#%E6%96%B9%E6%B3%95-2%E5%B0%86%E7%A7%81%E9%92%A5%E4%BF%A1%E6%81%AF%E5%86%99%E5%85%A5-sshconfig-%E6%96%87%E4%BB%B6" rel="">方法 2</a> 中进行解释。</p>
<h3 id="方法-2手动拷贝">方法 2：手动拷贝</h3>
<p>手动拷贝本机公钥内容到远程主机的 <code>~/.ssh/authorized_keys</code> 文件有很多方法，此处以 <code>scp</code> 复制公钥到远程主机为例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 先复制本机公钥到远程主机的 ~ 目录</span>
</span></span><span class="line"><span class="cl">scp C:<span class="se">\U</span>sers<span class="se">\$</span>ENV:USERNAME<span class="se">\k</span>eyToGPUServer.pub amax@192.168.50.50:~
</span></span></code></pre></td></tr></table>
</div>
</div><figure>
</figure>

<p>不过我这里的私钥权限太宽需要修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 当前用户只读</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">400</span> .ssh/keypair/keyToGPUServer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 当前用户读写</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">600</span> .ssh/keypair/keyToGPUServer
</span></span></code></pre></td></tr></table>
</div>
</div><p>传输完成后登入远程主机，将公钥内容写入到 <code>~/.ssh/authorized_keys</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 此时仍然需要以账户密码登录</span>
</span></span><span class="line"><span class="cl">ssh amax@192.168.50.50
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 添加到文件尾</span>
</span></span><span class="line"><span class="cl">cat keyToGPUServer.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x03-配置本机的私钥存储">0x03 配置本机的私钥存储</h2>
<blockquote>
<p>本地主机的 ssh 程序可通过：</p>
<ol>
<li>命令行（指 <code>ssh-agent</code> 工具）</li>
<li>（用户）配置文件 <code>~/.ssh/config</code></li>
<li>（全局）配置文件 <code>/etc/ssh/ssh_config</code></li>
</ol>
<p>来获得配置信息。三个位置的优先级由高到低，且在每个位置仅使用首个匹配成功的条目。</p>
<p><a href="https://www.ssh.com/ssh/config" target="_blank" rel="noopener noreffer">https://www.ssh.com/ssh/config</a></p>
</blockquote>
<h3 id="方法-1向-ssh-agent-添加私钥">方法 1：向 <code>ssh-agent</code> 添加私钥</h3>
<blockquote>
<p><code>ssh-agent</code> 用于保存和管理用户的私钥和私钥密码，借助它我们可以实现单点登录（Single Sign-On, SSO）。</p>
<p>在大多 Linux 系统中 <code>ssh-agent</code> 都已被自动配置且在登入时已启动。</p>
<p><a href="https://www.ssh.com/ssh/agent" target="_blank" rel="noopener noreffer">https://www.ssh.com/ssh/agent</a></p>
</blockquote>
<p>使用如下命令向 <code>ssh-agent</code> 添加私钥：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查是否启动</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$SSH_AGENT_SOCK</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 手动启动</span>
</span></span><span class="line"><span class="cl"><span class="nb">eval</span> <span class="sb">`</span>ssh-agent<span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 显示 ssh-agent 已安装私钥</span>
</span></span><span class="line"><span class="cl">ssh-add -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从 ssh-agent 移除指定名称私钥（不删除密钥文件）</span>
</span></span><span class="line"><span class="cl">ssh-add -d keyToGPUServer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从 ssh-agent 移除所有已添加私钥（不删除密钥文件）</span>
</span></span><span class="line"><span class="cl">ssh-add -D
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从默认位置添加默认名称的私钥</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  ~/.ssh/id_rsa, .ssh/id_dsa, ~/.ssh/id_ecdsa, ~/.ssh/id_ed25519, and ~/.ssh/identity</span>
</span></span><span class="line"><span class="cl">ssh-add
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 手动指定私钥位置和名称</span>
</span></span><span class="line"><span class="cl">ssh-add keypair/keyToGPUServer
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 成功认证</span>
</span></span><span class="line"><span class="cl">ssh amax@192.168.50.50
</span></span><span class="line"><span class="cl">amax@admin:~$
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="方法-2将私钥信息写入-sshconfig-文件">方法 2：将私钥信息写入 <code>~/.ssh/config</code> 文件</h3>
<p>Windows 下的对应文件是在 <code>C:\Users\$ENV:USERNAME\.ssh\config</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># https://www.ssh.com/ssh/config/#configuring-public-key-authentication</span>
</span></span><span class="line"><span class="cl">Host GPU
</span></span><span class="line"><span class="cl">    HostName 192.168.50.50
</span></span><span class="line"><span class="cl">    User amax
</span></span><span class="line"><span class="cl">    IdentityFile C:<span class="se">\U</span>sers<span class="se">\$</span>ENV:USERNAME<span class="se">\.</span>ssh<span class="se">\k</span>eypair<span class="se">\k</span>eyToGPUServer
</span></span><span class="line"><span class="cl">    IdentitiesOnly yes
</span></span><span class="line"><span class="cl">    Port <span class="m">22</span>
</span></span><span class="line"><span class="cl">    ServerAliveInterval <span class="m">60</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里的 Host 名称一定要起一个好记的，因为在之后使用 ssh 进行公钥认证时匹配的就是这里的 Host 名称而不再是 <code>&lt;username&gt;@&lt;ip-address&gt;</code>，本文第二张图下方没有成功通过公钥认证就是这个原因。</p>
<p>测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 如果前面还通过 ssh-agent 添加了相同的密钥，要先删除掉。因为找密钥的时候它的优先级更高</span>
</span></span><span class="line"><span class="cl">ssh-add -d keyToGPUServer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 只能通过 Host 名称才不要密码</span>
</span></span><span class="line"><span class="cl">ssh GPU
</span></span><span class="line"><span class="cl">amax@admin:~$
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 如果是通过用户名主机名去登录就还得输入密码</span>
</span></span><span class="line"><span class="cl">ssh amax@192.168.50.50
</span></span><span class="line"><span class="cl">amax@192.168.50.50<span class="err">&#39;</span>s password:
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>在 Google Colab 上 Debug 的正确方式</title><link>https://xuchunqiu.me/can-we-really-debug-in-google-colab/</link><pubDate>Wed, 16 Oct 2019 08:24:22 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/can-we-really-debug-in-google-colab/</guid><description><![CDATA[<p><a href="https://colab.research.google.com/notebooks/welcome.ipynb" target="_blank" rel="noopener noreffer">Colaboratory</a>（简称 Colab）是 Google 推出的免费、在线、具有 GPU 的 <a href="https://jupyter.org/" target="_blank" rel="noopener noreffer">JupyterLab</a> 环境，它的底层是一个虚拟的 Linux 系统，所以你在里面执行 Linux 命令也是没有问题的。</p>
<p>我的本科毕业设计是做的深度学习相关的内容，但自己笔记本电脑里的 GTX 950M（2G）显卡一跑代码就爆显存，所以不夸张地说我是全靠 Colab 才顺利毕业。</p>
<p>扯远了，本文主要是测试一下 Colab 调试代码的方法，结论就是对于结构比较复杂的代码 Colab 并不能很好地完成调试。</p>
<h2 id="0x00-一些-colab-使用心得">0x00 一些 Colab 使用心得</h2>
<h3 id="colab-的优点">Colab 的优点</h3>
<ul>
<li>环境配置简单。深度学习相关的很多软件包都是预装好的，省事省时；</li>
<li>网络环境通畅。数据中心带宽大，下载数据集嗖嗖的；
<figure><figcaption>
            <h4>下载预训练模型的速度</h4>
        </figcaption>
</figure>
</li>
<li>GPU 够用。原来白天能分到 Telsa T4，现在白天也只有 Tesla K80 了，但起码 11.4GB 的显存是实打实的；
<figure><figcaption>
            <h4>在 code cell 中使用 !nvidia-smi 命令查看 GPU 信息</h4>
        </figcaption>
</figure>
</li>
<li>支持 bash 命令。bash 命令想要在 code cell 里执行只需每行前加 <code>!</code> 就可以了；
<figure><figcaption>
            <h4>Colab 环境中 /bin 目录的内容</h4>
        </figcaption>
</figure>
</li>
<li>支持在线修改。对于大型工程，其代码必然分散在项目的各个文件夹里，以前想修改文件内容需要下载到本地修改然后再上传，十分繁琐。2019 年 10 月 4 日 Colab 支持了从文件树双击打开、修改文件。
<figure><figcaption>
            <h4>@GoogleColab 的推文截图</h4>
        </figcaption>
</figure>
</li>
<li>更多 Colab 特性可以查看 <a href="https://colab.research.google.com/notebooks/basic_features_overview.ipynb" target="_blank" rel="noopener noreffer">Google 的说明文档</a></li>
</ul>
<h3 id="colab-的缺点">Colab 的缺点</h3>
<ul>
<li>资源自动回收。据说是运行 12 小时后自动回收所有资源（另外实际经验是如果浏览器与 Colab 的连接不幸中断数小时也会触发回收），GPU 需要重新申请是其次，重要的是保存运行结果的临时硬盘空间也会被回收掉。所以可以考虑把 Google Drive 挂载上去然后结果直接存在里边，这就会带来下面第二个缺点；
<figure><figcaption>
            <h4>Colab 临时硬盘有 359 GB</h4>
        </figcaption>
</figure>
</li>
<li>与 Google Drive 不能无缝整合。同一份代码，直接在 Colab 临时硬盘空间运行与克隆到被挂载到 Colab 的 Google Drive 运行有明显可感的降速，瓶颈可能是 Google Drive 本身存储介质的 I/O 性能；
<figure><figcaption>
            <h4>Colab 临时硬盘与挂载的 Google Drive 在 Colab 中读写速度对比</h4>
        </figcaption>
</figure>

再者，即使 I/O 跟得上，Google Drive 提供的 15G 免费存储空间对于大数据集来说远远不够；</li>
<li>不易使用图形化监测工具如 Tensorboard / Visdom 。没有官方解决方案，必须依靠奇技淫巧——换用 TensorBoardX、给 Visdom 套上反向代理。</li>
</ul>
<h2 id="0x01-jupyter-101magic-commands">0x01 Jupyter 101：magic commands</h2>
<p>所谓 <strong><ruby>magic commands<rt>魔法命令</rt></ruby></strong> 就是在 Jupyter 代码块中以 <code>%</code> 或者 <code>%%</code> 作为行首的特殊命令。而 bash 命令需要使用 <code>!</code> 作为行首。</p>
<ul>
<li><code>%</code> 开头——行命令。只对命令所在的行有效</li>
<li><code>%%</code> 开头——单元命令。必须出现在单元的第一行，对整个单元的代码进行处理</li>
</ul>
<p>在代码块中输入 <code>%lsmagic</code> 然后执行会输出关于各个命令的说明，<strong>在魔法命令之后紧跟 <code>?</code> 可以查看该命令的详细说明</strong>。</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>常用魔法命令<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li><code>%cd</code> 进入目录命令（改变本代码块的 <strong><ruby>当前工作目录<rt>current working directory</rt></ruby></strong> 并在之后的代码块中保持，而 <code>!cd</code> 仅对当前行有效）</li>
<li><code>%load_ext</code> 根据模块名载入模块（可以用于在本代码块的输出中载入 tensorboardX）</li>
<li><code>%magic</code> 显示所有魔法命令的详细文档</li>
<li><code>%whos</code> 打印所有变量及其类型和值</li>
<li><code>%xdel</code> 删除指定变量</li>
<li><code>%set_env &lt;var&gt; &lt;val&gt;</code> 设定环境变量的值</li>
<li><code>%psource</code> 打印对象的源代码</li>
<li><code>%pinfo</code> 打印对象的详细信息</li>
<li><code>%pfile</code> 打印对象的定义</li>
<li><code>%%latex</code> 以 $LaTeX$ 格式渲染 cell</li>
<li><code>%run script.py</code> 在ipython中执行一个外部的脚本文件</li>
<li><code>%%python3</code> 以 Python 3 执行 cell（Python 2 同理）</li>
<li><code>%hist</code> 查询输入的历史</li>
<li><code>%writefile [-a] filename</code> 把 cell 的内容写/追加入文件（别名 file）</li>
<li><code>%env</code> 显示所有/特定/修改系统环境变量</li>
<li><code>%reset</code> 清空 namespace</li>
<li><code>%load</code> 加载代码到前端（可以是链接）</li>
</ul>
<p><a href="http://nbviewer.jupyter.org/github/supergis/git_notebook/blob/master/pystart/jupyter_magics.ipynb" target="_blank" rel="noopener noreffer">http://nbviewer.jupyter.org/github/supergis/git_notebook/blob/master/pystart/jupyter_magics.ipynb</a></div>
        </div>
    </div>
<h2 id="0x02-使用-ipdb-进行调试">0x02 使用 ipdb 进行调试</h2>
<div class="details admonition quote open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-quote-right fa-fw"></i>Quote<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>常规的 Python 交互式 debug 工具是 pdb，它可以让我们 <strong><ruby>单步<rt>Step Trough</rt></ruby></strong> 调试；IPython 改进版的 pdb 被称为 ipdb 。</p>
<p><a href="https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/01.06-Errors-and-Debugging.ipynb" target="_blank" rel="noopener noreffer">https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/01.06-Errors-and-Debugging.ipynb</a></p>
</div>
        </div>
    </div>
<p>在 IPython 内核环境中最方便的调用 ipdb 的方法是使用魔法命令 <code>%debug</code>。如果是在遇到异常之后立刻运行 <code>%debug</code> 则会自动在异常位置打开一个<strong><ruby>交互式调试提示符<rt>Interactive Debugging Prompt</rt></ruby></strong>，该 ipdb 调试提示符可以实现检查当前栈、变量或是使用 Python 命令。以下是简单示范：</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<p>当调用 <code>func2(1)</code> 时，将抛出异常：</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell output<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;ipython-input-4-b2e110f6fc8f&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    func2<span class="o">(</span>1<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">1</span> frames
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;ipython-input-1-d849e34d61fb&gt;&#34;</span>, line 7, in func2
</span></span><span class="line"><span class="cl">    <span class="k">return</span> func1<span class="o">(</span>a, b<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;ipython-input-1-d849e34d61fb&gt;&#34;</span>, line 2, in func1
</span></span><span class="line"><span class="cl">    <span class="k">return</span> a / b
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ZeroDivisionError: division by zero
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<p>使用 ipdb 调试：</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell output<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">d849e34d61fb</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="n">func1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="mi">1</span> <span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">2</span>     <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
</span></span><span class="line"><span class="cl">      <span class="mi">3</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ipdb</span><span class="o">&gt;</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">d849e34d61fb</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="n">func2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="mi">5</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">      <span class="mi">6</span>     <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">7</span>     <span class="k">return</span> <span class="n">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ipdb</span><span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">ipdb</span><span class="o">&gt;</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="n">b2e110f6fc8f</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">func2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ipdb</span><span class="o">&gt;</span> <span class="n">down</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">d849e34d61fb</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="n">func2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="mi">5</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">      <span class="mi">6</span>     <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">----&gt;</span> <span class="mi">7</span>     <span class="k">return</span> <span class="n">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ipdb</span><span class="o">&gt;</span> <span class="n">quit</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>常用 ipdb 命令<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><table>
<thead>
<tr>
<th style="text-align:left">Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>list</code></td>
<td>显示当前行的上下5行</td>
</tr>
<tr>
<td style="text-align:left"><code>up</code></td>
<td>步退</td>
</tr>
<tr>
<td style="text-align:left"><code>down</code></td>
<td>步进</td>
</tr>
<tr>
<td style="text-align:left"><code>n(ext)</code></td>
<td>当前文件中下一步 Go to the next step of the program</td>
</tr>
<tr>
<td style="text-align:left"><code>s(tep)</code></td>
<td>下一步，如果有就进入子函数（Step into a subroutine）</td>
</tr>
<tr>
<td style="text-align:left"><code>r(eturn)</code></td>
<td>退出子函数（Return out of a subroutine）</td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;enter&gt;</code></td>
<td>重复前条命令</td>
</tr>
<tr>
<td style="text-align:left"><code>p(rint)</code></td>
<td>打印指定变量值</td>
</tr>
<tr>
<td style="text-align:left"><code>c(ontinue)</code></td>
<td>退出调试器，继续运行程序</td>
</tr>
<tr>
<td style="text-align:left"><code>q(uit)</code></td>
<td>退出调试器，终止程序</td>
</tr>
<tr>
<td style="text-align:left"><code>h(elp)</code></td>
<td>显示所有命令/指定命令的帮助</td>
</tr>
<tr>
<td style="text-align:left"><code>b LINE</code></td>
<td>在指定行设置断点</td>
</tr>
</tbody>
</table>
<p><a href="https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/01.06-Errors-and-Debugging.ipynb#scrollTo=MNC9gzvgplsp" target="_blank" rel="noopener noreffer">https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/01.06-Errors-and-Debugging.ipynb#scrollTo=MNC9gzvgplsp</a></div>
        </div>
    </div>
<p>上述例子调用 ipdb 发生在产生异常之后，目的是为了<strong>修改程序中的错误</strong>；如果我们的程序运行良好，想通过调试<strong>观察函数调用</strong>，就不能再用简单的行魔法命令 <code>%debug</code> 而是为其加上参数甚至变成单元命令。</p>
<blockquote>
<p><code>%pdb</code> 与 <code>%debug</code> 用法的不同（总结自 <code>%debug?</code>）</p>
<ul>
<li>
<p>如果想在每次 <strong>产生异常后</strong> 让 IPython <strong>自动进入</strong> 交互式调试提示符—— <code>%pdb on</code> 或者 <code>%pdb 1</code></p>
</li>
<li>
<p>如果想在每次<strong><ruby><strong>产生异常后</strong><rt>Post-mortem Mode</rt></ruby></strong> <strong>手动进入</strong> 交互式调试提示符——不加参数地使用 <code>%debug</code></p>
</li>
<li>
<p>如果想<strong>无论有没有异常</strong>都激活交互式调试提示符——带参数地使用 <code>%debug</code></p>
</li>
</ul>
</blockquote>
<h3 id="如何带参数地使用-debug">如何带参数地使用 <code>%debug</code></h3>
<h4 id="失败的尝试">失败的尝试</h4>
<ul>
<li>
<p><code>%debug –breakpoint &lt;FILE&gt;:&lt;LINE&gt;</code> 结果：无法调起 ipdb 交互式调试提示符。只会显示一个不响应 ipdb 命令的输入框。
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell and output<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">  <figure>
</figure>
  <figure>
</figure>
</div>
        </div>
    </div></p>
</li>
<li>
<p><code>%%debug –breakpoint &lt;FILE&gt;:&lt;LINE&gt;</code> 结果：无法运行到标记的断点。Python 处理基本调试器函数的 bdb 模块出现异常，未搜到解决方法。尝试不加 <code>-b</code> 参数异常不变。
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell and output<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">  <figure>
</figure>
</div>
        </div>
    </div></p>
</li>
</ul>
<h4 id="可行方式">可行方式</h4>
<p>手动在程序中设置断点。但调试过程复杂低效。首先要先在 Jupyter 环境安装 ipdb：</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 安装 ipdb</span>
</span></span><span class="line"><span class="cl"><span class="c1"># P.S. 按 https://stackoverflow.com/a/32409822/8178171 的讨论也可以使用 pdb，那么下面加断点时也要改成 pdb</span>
</span></span><span class="line"><span class="cl">!pip3 install ipdb
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<p>然后在代码中加入断点：
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell or *.py<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 源程序想设置断点处：添加此行</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ipdb</span><span class="p">;</span> <span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div></p>
<p>实际效果如下：</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Jupyter code cell and output<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><figure>
</figure>
</div>
        </div>
    </div>
]]></description></item><item><title>在 Colab 运行 Faster R-CNN 时的问题简记</title><link>https://xuchunqiu.me/run-faster-r-cnn-on-colab/</link><pubDate>Mon, 23 Sep 2019 13:08:02 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/run-faster-r-cnn-on-colab/</guid><description><![CDATA[<h2 id="0x00-相关链接">0x00 相关链接</h2>
<ul>
<li>使用 Pytorch 框架下实现的 Faster R-CNN：<a href="https://github.com/jwyang/faster-rcnn.pytorch/tree/pytorch-1.0" target="_blank" rel="noopener noreffer">jwyang/faster-rcnn.pytorch</a></li>
<li>主要参考文章：<a href="https://www.twblogs.net/a/5cb44531bd9eee48d788c415" target="_blank" rel="noopener noreffer">使用 colab 訓練 faster-rcnn</a></li>
</ul>
<h2 id="0x01-操作步骤">0x01 操作步骤</h2>
<h3 id="克隆仓库">克隆仓库</h3>
<p>使用 <code>-b</code> 参数指定 <strong><ruby>分支<rt>branch</rt></ruby></strong> 为 <code>pytorch-1.0</code>，否则后续编译出错</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">pytorch</span><span class="o">-</span><span class="mf">1.0</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jwyang</span><span class="o">/</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">.</span><span class="n">pytorch</span><span class="o">.</span><span class="n">git</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="下载预训练模型数据集">下载预训练模型、数据集</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 进入下载好代码的主目录</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;faster-rcnn.pytorch&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 下载预训练模型</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">ls</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">mkdir</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">mkdir</span> <span class="n">pretrained_model</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;pretrained_model&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 下载 res101</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">filebox</span><span class="o">.</span><span class="n">ece</span><span class="o">.</span><span class="n">vt</span><span class="o">.</span><span class="n">edu</span><span class="o">/~</span><span class="n">jw2yang</span><span class="o">/</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">/</span><span class="n">pretrained</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">models</span><span class="o">/</span><span class="n">resnet101_caffe</span><span class="o">.</span><span class="n">pth</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 下载 vgg16</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">filebox</span><span class="o">.</span><span class="n">ece</span><span class="o">.</span><span class="n">vt</span><span class="o">.</span><span class="n">edu</span><span class="o">/~</span><span class="n">jw2yang</span><span class="o">/</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">/</span><span class="n">pretrained</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">models</span><span class="o">/</span><span class="n">vgg16_caffe</span><span class="o">.</span><span class="n">pth</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 下载数据集</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span> <span class="c1">#返回上一級目录即data/下</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">ox</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="o">/</span><span class="n">pascal</span><span class="o">/</span><span class="n">VOC</span><span class="o">/</span><span class="n">voc2007</span><span class="o">/</span><span class="n">VOCtrainval_06</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">ox</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="o">/</span><span class="n">pascal</span><span class="o">/</span><span class="n">VOC</span><span class="o">/</span><span class="n">voc2007</span><span class="o">/</span><span class="n">VOCtest_06</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">ox</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span><span class="o">/</span><span class="n">pascal</span><span class="o">/</span><span class="n">VOC</span><span class="o">/</span><span class="n">voc2007</span><span class="o">/</span><span class="n">VOCdevkit_08</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 解压缩</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">tar</span> <span class="n">xvf</span> <span class="n">VOCtrainval_06</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">tar</span> <span class="n">xvf</span> <span class="n">VOCtest_06</span><span class="o">-</span><span class="n">Nov</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">tar</span> <span class="n">xvf</span> <span class="n">VOCdevkit_08</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mf">2007.</span><span class="n">tar</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 解压后的文件夹名称需要修改否则网络训练过程中会找不到路径。报错见问题 2</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">mv</span> <span class="n">VOCdevkit</span> <span class="n">VOCdevkit2007</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="编译">编译</h3>
<p>回到上一级路径，然后进入 <code>lib</code> 编译</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../lib&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">!</span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> <span class="n">develop</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="训练">训练</h3>
<p>首先修改编译好文件 <code>faster-rcnn.pytorch/lib/roi_data_layer/minibatch.py</code>  。原因见问题 1。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/from scipy.misc import imread/from matplotlib.pyplot import imread/g&#39;</span> <span class="n">roi_data_layer</span><span class="o">/</span><span class="n">minibatch</span><span class="o">.</span><span class="n">py</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>给定超参数开始训练：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">.</span><span class="n">pytorch</span> <span class="o">&amp;&amp;</span> <span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span> <span class="n">python</span> <span class="n">trainval</span>\<span class="n">_net</span><span class="o">.</span><span class="n">py</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">dataset</span> <span class="n">pascal_voc</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">net</span> <span class="n">res101</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">bs</span> <span class="mi">4</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">nw</span> <span class="mi">0</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">lr</span> <span class="mf">0.004</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">lr_decay_step</span> <span class="mi">8</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">epochs</span> <span class="mi">10</span> \
</span></span><span class="line"><span class="cl">                <span class="o">--</span><span class="n">cuda</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x02-已解决问题">0x02 已解决问题</h2>
<h3 id="问题-1无法导入-imread">问题 1：无法导入 <code>imread</code></h3>
<p>开始训练时文件 <code>faster-rcnn.pytorch/lib/roi_data_layer/minibatch.py</code> 无法从 <code>scipy.misc</code> 导入 <code>imread</code> 。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;trainval_net.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">28</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">roi_data_layer.roibatchLoader</span> <span class="kn">import</span> <span class="n">roibatchLoader</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/roi_data_layer/roibatchLoader.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">14</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">roi_data_layer.minibatch</span> <span class="kn">import</span> <span class="n">get_minibatch</span><span class="p">,</span> <span class="n">get_minibatch</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/roi_data_layer/minibatch.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">15</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">imread</span>
</span></span><span class="line"><span class="cl"><span class="ne">ImportError</span><span class="p">:</span> <span class="n">cannot</span> <span class="kn">import</span> <span class="nn">name</span> <span class="s1">&#39;imread&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>参考 <a href="https://stackoverflow.com/a/49586881" target="_blank" rel="noopener noreffer">https://stackoverflow.com/a/49586881</a> 改为从 <code>matplotlib.pyplot</code> 导入。</p>
<blockquote>
<p><a href="https://docs.scipy.org/doc/scipy-1.2.1/reference/generated/scipy.misc.imread.html#scipy.misc.imread" target="_blank" rel="noopener noreffer"><code>imread</code></a> is deprecated in SciPy 1.0.0, and will be removed in 1.2.0. Use <code>imageio.imread</code> instead.</p>
<p><a href="https://docs.scipy.org/doc/scipy-1.2.1/reference/generated/scipy.misc.imread.html" target="_blank" rel="noopener noreffer">https://docs.scipy.org/doc/scipy-1.2.1/reference/generated/scipy.misc.imread.html</a></p>
<p>所以也可以 <code>!pip install scipy==1.0.0</code> ，印象中好像 pip3 不行</p>
</blockquote>
<h3 id="问题-2找不到数据集">问题 2：找不到数据集</h3>
<p>开始训练时找不到数据集。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;trainval_net.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">197</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">imdb</span><span class="p">,</span> <span class="n">roidb</span><span class="p">,</span> <span class="n">ratio_list</span><span class="p">,</span> <span class="n">ratio_index</span> <span class="o">=</span> <span class="n">combined_roidb</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">imdb_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/roi_data_layer/roidb.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">116</span><span class="p">,</span> <span class="ow">in</span> <span class="n">combined_roidb</span>
</span></span><span class="line"><span class="cl">    <span class="n">roidbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_roidb</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">imdb_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/roi_data_layer/roidb.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">116</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">roidbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_roidb</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">imdb_names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/roi_data_layer/roidb.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">109</span><span class="p">,</span> <span class="ow">in</span> <span class="n">get_roidb</span>
</span></span><span class="line"><span class="cl">    <span class="n">imdb</span> <span class="o">=</span> <span class="n">get_imdb</span><span class="p">(</span><span class="n">imdb_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/datasets/factory.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">66</span><span class="p">,</span> <span class="ow">in</span> <span class="n">get_imdb</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">__sets</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/datasets/factory.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">25</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">__sets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">:</span> <span class="n">pascal_voc</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">year</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/datasets/pascal_voc.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">56</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">_image_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_image_set_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="n">File</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/lib/datasets/pascal_voc.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">107</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_load_image_set_index</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Path does not exist: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_set_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="ne">AssertionError</span><span class="p">:</span> <span class="n">Path</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span><span class="p">:</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">faster</span><span class="o">-</span><span class="n">rcnn</span><span class="o">.</span><span class="n">pytorch</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">VOCdevkit2007</span><span class="o">/</span><span class="n">VOC2007</span><span class="o">/</span><span class="n">ImageSets</span><span class="o">/</span><span class="n">Main</span><span class="o">/</span><span class="n">trainval</span><span class="o">.</span><span class="n">txt</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为下载完的数据集解压缩后默认文件夹是 <code>VOCdevkit</code>，而代码中写死了去 <code>VOCdevkit2007</code> 找。</p>
<h2 id="0x03-补充tensorboard-在-colab-里的用法简记">0x03 补充：TensorBoard 在 Colab 里的用法简记</h2>
<h3 id="为什么这是个问题">为什么这是个问题？</h3>
<p>Colab 是远程操作，不像本机使用的话环回地址加端口号就访问得到，Colab 宿主机的 IP 不允许公网直接访问，需要反代才能正常访问 Colab 开放出来的 Tensorbaord 端口。如果不反代就只能用 <code>tensorboardX</code>。</p>
<h3 id="操作步骤">操作步骤</h3>
<ol>
<li>
<p>安装 TensorBoard for Pytorch：<a href="https://github.com/lanpa/tensorboardX" target="_blank" rel="noopener noreffer">TensorBoardX</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorboardX</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据 TensorBoardX 项目主页的教程我们其实还需要安装 TensorBoard，但 <a href="https://www.tensorflow.org/guide/summaries_and_tensorboard?hl=zh-cn" target="_blank" rel="noopener noreffer">通过 pip 安装 TensorFlow 时，也会自动安装 TensorBoard</a>。 Colab 作为 Google 亲儿子，自然已经安装妥当。</p>
</li>
<li>
<p>在程序中引入（修改 faster-rcnn.pytorch 项目中的已有代码）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">tensorboardX</span> <span class="kn">import</span> <span class="n">SummaryWriter</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span> <span class="o">=</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="s2">&#34;logs&#34;</span><span class="p">)</span><span class="c1"># 指定传递给TensorBoardX用来绘图的数据的存放位置：</span>
</span></span><span class="line"><span class="cl">                                <span class="c1"># 项目根目录下的logs文件夹，其在训练开始后自动创建</span>
</span></span><span class="line"><span class="cl"><span class="err">……</span>
</span></span><span class="line"><span class="cl"><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="n">loss_temp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;loss_rpn_cls&#39;</span><span class="p">:</span> <span class="n">loss_rpn_cls</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;loss_rpn_box&#39;</span><span class="p">:</span> <span class="n">loss_rpn_box</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;loss_rcnn_cls&#39;</span><span class="p">:</span> <span class="n">loss_rcnn_cls</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;loss_rcnn_box&#39;</span><span class="p">:</span> <span class="n">loss_rcnn_box</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span><span class="o">.</span><span class="n">add_scalars</span><span class="p">(</span><span class="s2">&#34;logs_s_</span><span class="si">{}</span><span class="s2">/losses&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">session</span><span class="p">),</span> <span class="n">info</span><span class="p">,</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">iters_per_epoch</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用 <strong><ruby>魔法函数<rt>MagicCommands</rt></ruby></strong> 启用 TensorBaordX</p>
<p>魔法函数是 IPython 内核的特性，意在简明地解决数据处理过程中的常见问题。</p>
<blockquote>
<p>%load_ext</p>
<p>Load an IPython extension by its module name.</p>
<p><a href="https://ipython.readthedocs.io/en/stable/interactive/magics.html" target="_blank" rel="noopener noreffer">https://ipython.readthedocs.io/en/stable/interactive/magics.html</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">load_ext</span> <span class="n">tensorboard</span>
</span></span><span class="line"><span class="cl"><span class="c1"># %reload_ext tensorboard</span>
</span></span><span class="line"><span class="cl"><span class="o">%</span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span> <span class="s2">&#34;/content/faster-rcnn.pytorch/logs&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个 code cell 执行完毕后不会终止而是默默等待数据，接着再执行训练 code cell 这边就会出曲线了。</p>
</li>
</ol>
<h3 id="更多-tensorboard-教程">更多 Tensorboard 教程：</h3>
<ul>
<li><a href="https://www.tensorflow.org/guide/summaries_and_tensorboard?hl=zh-cn" target="_blank" rel="noopener noreffer">https://www.tensorflow.org/guide/summaries_and_tensorboard?hl=zh-cn</a></li>
<li><a href="https://colab.research.google.com/drive/1NbEqqB42VSzYt-mmb4ESc8yxL05U2TIV#scrollTo=ZnDqxE2msZbd" target="_blank" rel="noopener noreffer">https://colab.research.google.com/drive/1NbEqqB42VSzYt-mmb4ESc8yxL05U2TIV#scrollTo=ZnDqxE2msZbd</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/39115355" target="_blank" rel="noopener noreffer">https://zhuanlan.zhihu.com/p/39115355</a></li>
</ul>
]]></description></item><item><title>如何在 Ubuntu 上安装配置 Rime 输入法</title><link>https://xuchunqiu.me/install-and-setup-rime-on-ubuntu/</link><pubDate>Fri, 24 May 2019 01:04:47 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/install-and-setup-rime-on-ubuntu/</guid><description><![CDATA[<p>Ubuntu 上比较流行又好装的中文输入法应该就只有 <a href="https://pinyin.sogou.com/linux/" target="_blank" rel="noopener noreffer">搜狗输入法 for Linux</a> 一款了，但如果你追求简洁纯粹，那 <a href="https://rime.im" target="_blank" rel="noopener noreffer">Rime 输入法</a> 或许是你的菜。</p>
<p>Rime 是一款由 <a href="https://github.com/lotem" target="_blank" rel="noopener noreffer">佛振</a> 主导开发的自由软件，支持在 Windows、macOS 和 Linux 操作系统上运行。它的优点是干净纯粹支持高度的客制化，缺点是较差的联想功能（自己慢慢养词库或者导入其它输入法的词库）和比较复杂的配置。本文将专注于介绍 Rime 在安装阶段的配置过程。</p>
<h2 id="1-基本安装">1. 基本安装</h2>
<p>在 <a href="https://rime.im/download/#Linux" target="_blank" rel="noopener noreffer">Rime 下载页面的 Linux 章节</a> 中给出了基于 IBus 和 Fcitx 两种输入法框架的安装指导，我这里是选择 IBus 框架：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt-get install ibus-rime
</span></span><span class="line"><span class="cl"><span class="c1"># 可选：安装双拼</span>
</span></span><span class="line"><span class="cl">sudo apt-get install librime-data-double-pinyin 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-切换到-ibus">2. 切换到 IBus</h2>
<p>从启动台打开「输入法」或在终端中使用命令开启：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">im-config
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后选择 <code>ibus</code></p>
<h2 id="3-添加-rime-到-ibus">3. 添加 Rime 到 IBus</h2>
<p>在终端中使用以下命令开启 IBus 设置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ibus-setup
</span></span></code></pre></td></tr></table>
</div>
</div><p>在输入法中添加 <code>Chinese - Rime</code>。如果看不到这一项，需要在系统设置的语言中添加中文并拖动到最顶，然后登出系统以使新的语言设置生效。</p>
<h2 id="4-切换-ibus-engine-到-rime">4. 切换 IBus engine 到 Rime</h2>
<p>使用如下命令切换到 Rime：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ibus engine rime
</span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>其它有用的命令<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 列出所有可用引擎</span>
</span></span><span class="line"><span class="cl">ibus list-engine
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看当前使用引擎</span>
</span></span><span class="line"><span class="cl">ibus engine
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<h2 id="5-可选在-rime-中启用小鹤双拼">5. 可选：在 Rime 中启用小鹤双拼</h2>
<p>修改配置文件 <code>~/.config/ibus/rime/default.yaml</code> ，依照现有布局加入条目：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="l">schema：double_pinyin_flypy</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>然后在输入时就能通过 <code>ctrl</code> + `/`` 呼出方案选单。</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">更多配置教程请查阅 <a href="https://rime.im/docs/" target="_blank" rel="noopener noreffer">Rime 帮助文档</a></div>
        </div>
    </div>
]]></description></item><item><title>为 Linux 上的 Caffe 启用 GPU 支持</title><link>https://xuchunqiu.me/enable-gpu-support-for-caffe-on-linux/</link><pubDate>Tue, 09 Apr 2019 00:33:53 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/enable-gpu-support-for-caffe-on-linux/</guid><description><![CDATA[<h2 id="0x00-下载-cuda-和-cudnn">0x00 下载 CUDA 和 cuDNN</h2>
<p>下载 <code>CUDA Toolkit 8.0</code> 和 <code>cuDNN v7.1.4, for CUDA 8.0</code></p>
<ul>
<li>
<p>CUDA 下载：https://developer.nvidia.com/cuda-80-ga2-download-archive</p>
</li>
<li>
<p>cuDNN 下载：https://developer.nvidia.com/rdp/cudnn-archive</p>
</li>
</ul>
<h2 id="0x01-安装-cuda">0x01 安装 <code>CUDA</code></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# sudo sh cuda_8.0.61_375.26_linux.run
</span></span><span class="line"><span class="cl">……
</span></span><span class="line"><span class="cl">Do you accept the previously <span class="nb">read</span> EULA?
</span></span><span class="line"><span class="cl">accept/decline/quit: accept
</span></span><span class="line"><span class="cl">Install NVIDIA Accelerated Graphics Driver <span class="k">for</span> Linux-x86_64 375.26?
</span></span><span class="line"><span class="cl"><span class="o">(</span>y<span class="o">)</span>es/<span class="o">(</span>n<span class="o">)</span>o/<span class="o">(</span>q<span class="o">)</span>uit: n
</span></span><span class="line"><span class="cl">Install the CUDA 8.0 Toolkit?
</span></span><span class="line"><span class="cl"><span class="o">(</span>y<span class="o">)</span>es/<span class="o">(</span>n<span class="o">)</span>o/<span class="o">(</span>q<span class="o">)</span>uit: y
</span></span><span class="line"><span class="cl">Enter Toolkit Location
</span></span><span class="line"><span class="cl"> <span class="o">[</span> default is /usr/local/cuda-8.0 <span class="o">]</span>: 
</span></span><span class="line"><span class="cl"><span class="c1"># CUDA_HOME=/usr/local/cuda</span>
</span></span><span class="line"><span class="cl">Do you want to install a symbolic link at /usr/local/cuda?
</span></span><span class="line"><span class="cl"><span class="o">(</span>y<span class="o">)</span>es/<span class="o">(</span>n<span class="o">)</span>o/<span class="o">(</span>q<span class="o">)</span>uit: y
</span></span><span class="line"><span class="cl">Install the CUDA 8.0 Samples?
</span></span><span class="line"><span class="cl"><span class="o">(</span>y<span class="o">)</span>es/<span class="o">(</span>n<span class="o">)</span>o/<span class="o">(</span>q<span class="o">)</span>uit: y
</span></span><span class="line"><span class="cl">Enter CUDA Samples Location
</span></span><span class="line"><span class="cl"> <span class="o">[</span> default is /home/user <span class="o">]</span>: 
</span></span><span class="line"><span class="cl">Installing the CUDA Toolkit in /usr/local/cuda-8.0 ...
</span></span><span class="line"><span class="cl">Installing the CUDA Samples in /home/user ...
</span></span><span class="line"><span class="cl">Copying samples to /home/user/NVIDIA_CUDA-8.0_Samples now...
</span></span><span class="line"><span class="cl">Finished copying samples.
</span></span><span class="line"><span class="cl">Installing the CUDA Toolkit in /usr/local/cuda-8.0 ...
</span></span><span class="line"><span class="cl">Missing recommended library: libGLU.so
</span></span><span class="line"><span class="cl">Missing recommended library: libXmu.so
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Installing the CUDA Samples in /home/user ...
</span></span><span class="line"><span class="cl">Copying samples to /home/user/NVIDIA_CUDA-8.0_Samples now...
</span></span><span class="line"><span class="cl">Finished copying samples.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===========</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span> <span class="nv">Summary</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="o">===========</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Driver:   Not Selected
</span></span><span class="line"><span class="cl">Toolkit:  Installed in /usr/local/cuda-8.0
</span></span><span class="line"><span class="cl">Samples:  Installed in /home/user, but missing recommended libraries
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Please make sure that
</span></span><span class="line"><span class="cl"> -   PATH includes /usr/local/cuda-8.0/bin
</span></span><span class="line"><span class="cl"> -   LD_LIBRARY_PATH includes /usr/local/cuda-8.0/lib64, or, add /usr/local/cuda-8.0/lib64 to /etc/ld.so.conf and run ldconfig as root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-8.0/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-8.0/doc/pdf <span class="k">for</span> detailed information on setting up CUDA.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 361.00 is required <span class="k">for</span> CUDA 8.0 functionality to work.
</span></span><span class="line"><span class="cl">To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:
</span></span><span class="line"><span class="cl">    sudo &lt;CudaInstaller&gt;.run -silent -driver
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Logfile is /tmp/cuda_install_6304.log
</span></span><span class="line"><span class="cl">Signal caught, cleaning up
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="故障排除missing-libglusolibxmuso">故障排除：Missing libGLU.so、libXmu.so</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 对于 Missing recommended library: libGLU.so</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 和 Missing recommended library: libXmu.so</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 安装依赖库：</span>
</span></span><span class="line"><span class="cl">user@machine:~# sudo apt-get install freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 对于 ***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 361.00 is required for CUDA 8.0 functionality to work. 不用管</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="将-cuda-安装目录写入环境变量">将 <code>CUDA</code> 安装目录写入环境变量</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# sudo vim ~/.bashrc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将以下内容写入到~/.bashrc尾部：</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/cuda-8.0/bin<span class="si">${</span><span class="nv">PATH</span><span class="p">:+:</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}}</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/cuda-8.0/lib64<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">:+:</span><span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="si">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="运行-cuda-测试用例">运行 <code>CUDA</code> 测试用例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# <span class="nb">cd</span> /usr/local/cuda-8.0/samples/1_Utilities/deviceQuery
</span></span><span class="line"><span class="cl">user@machine:~# sudo make
</span></span><span class="line"><span class="cl"><span class="s2">&#34;/usr/local/cuda-8.0&#34;</span>/bin/nvcc -ccbin g++ -I../../common/inc  -m64    -gencode <span class="nv">arch</span><span class="o">=</span>compute_20,code<span class="o">=</span>sm_20 -gencode <span class="nv">arch</span><span class="o">=</span>compute_30,code<span class="o">=</span>sm_30 -gencode <span class="nv">arch</span><span class="o">=</span>compute_35,code<span class="o">=</span>sm_35 -gencode <span class="nv">arch</span><span class="o">=</span>compute_37,code<span class="o">=</span>sm_37 -gencode <span class="nv">arch</span><span class="o">=</span>compute_50,code<span class="o">=</span>sm_50 -gencode <span class="nv">arch</span><span class="o">=</span>compute_52,code<span class="o">=</span>sm_52 -gencode <span class="nv">arch</span><span class="o">=</span>compute_60,code<span class="o">=</span>sm_60 -gencode <span class="nv">arch</span><span class="o">=</span>compute_60,code<span class="o">=</span>compute_60 -o deviceQuery.o -c deviceQuery.cpp
</span></span><span class="line"><span class="cl">nvcc warning : The <span class="s1">&#39;compute_20&#39;</span>, <span class="s1">&#39;sm_20&#39;</span>, and <span class="s1">&#39;sm_21&#39;</span> architectures are deprecated, and may be removed in a future release <span class="o">(</span>Use -Wno-deprecated-gpu-targets to suppress warning<span class="o">)</span>.
</span></span><span class="line"><span class="cl"><span class="s2">&#34;/usr/local/cuda-8.0&#34;</span>/bin/nvcc -ccbin g++   -m64      -gencode <span class="nv">arch</span><span class="o">=</span>compute_20,code<span class="o">=</span>sm_20 -gencode <span class="nv">arch</span><span class="o">=</span>compute_30,code<span class="o">=</span>sm_30 -gencode <span class="nv">arch</span><span class="o">=</span>compute_35,code<span class="o">=</span>sm_35 -gencode <span class="nv">arch</span><span class="o">=</span>compute_37,code<span class="o">=</span>sm_37 -gencode <span class="nv">arch</span><span class="o">=</span>compute_50,code<span class="o">=</span>sm_50 -gencode <span class="nv">arch</span><span class="o">=</span>compute_52,code<span class="o">=</span>sm_52 -gencode <span class="nv">arch</span><span class="o">=</span>compute_60,code<span class="o">=</span>sm_60 -gencode <span class="nv">arch</span><span class="o">=</span>compute_60,code<span class="o">=</span>compute_60 -o deviceQuery deviceQuery.o 
</span></span><span class="line"><span class="cl">nvcc warning : The <span class="s1">&#39;compute_20&#39;</span>, <span class="s1">&#39;sm_20&#39;</span>, and <span class="s1">&#39;sm_21&#39;</span> architectures are deprecated, and may be removed in a future release <span class="o">(</span>Use -Wno-deprecated-gpu-targets to suppress warning<span class="o">)</span>.
</span></span><span class="line"><span class="cl">mkdir -p ../../bin/x86_64/linux/release
</span></span><span class="line"><span class="cl">cp deviceQuery ../../bin/x86_64/linux/release
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 如果显示一些关于GPU的信息，则说明安装成功</span>
</span></span><span class="line"><span class="cl">user@machine:~# sudo ./deviceQuery
</span></span><span class="line"><span class="cl">./deviceQuery Starting...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CUDA Device Query <span class="o">(</span>Runtime API<span class="o">)</span> version <span class="o">(</span>CUDART static linking<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Detected <span class="m">1</span> CUDA Capable device<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Device 0: <span class="s2">&#34;GeForce GTX 950M&#34;</span>
</span></span><span class="line"><span class="cl">CUDA Driver Version / Runtime Version          9.0 / 8.0
</span></span><span class="line"><span class="cl">CUDA Capability Major/Minor version number:    5.0
</span></span><span class="line"><span class="cl">Total amount of global memory:                 <span class="m">2003</span> MBytes <span class="o">(</span><span class="m">2100232192</span> bytes<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span> 5<span class="o">)</span> Multiprocessors, <span class="o">(</span>128<span class="o">)</span> CUDA Cores/MP:     <span class="m">640</span> CUDA Cores
</span></span><span class="line"><span class="cl">GPU Max Clock rate:                            <span class="m">1124</span> MHz <span class="o">(</span>1.12 GHz<span class="o">)</span>
</span></span><span class="line"><span class="cl">Memory Clock rate:                             <span class="m">900</span> Mhz
</span></span><span class="line"><span class="cl">Memory Bus Width:                              128-bit
</span></span><span class="line"><span class="cl">L2 Cache Size:                                 <span class="m">2097152</span> bytes
</span></span><span class="line"><span class="cl">Maximum Texture Dimension Size <span class="o">(</span>x,y,z<span class="o">)</span>         <span class="nv">1D</span><span class="o">=(</span>65536<span class="o">)</span>, <span class="nv">2D</span><span class="o">=(</span>65536, 65536<span class="o">)</span>, <span class="nv">3D</span><span class="o">=(</span>4096, 4096, 4096<span class="o">)</span>
</span></span><span class="line"><span class="cl">Maximum Layered 1D Texture Size, <span class="o">(</span>num<span class="o">)</span> layers  <span class="nv">1D</span><span class="o">=(</span>16384<span class="o">)</span>, <span class="m">2048</span> layers
</span></span><span class="line"><span class="cl">Maximum Layered 2D Texture Size, <span class="o">(</span>num<span class="o">)</span> layers  <span class="nv">2D</span><span class="o">=(</span>16384, 16384<span class="o">)</span>, <span class="m">2048</span> layers
</span></span><span class="line"><span class="cl">Total amount of constant memory:               <span class="m">65536</span> bytes
</span></span><span class="line"><span class="cl">Total amount of shared memory per block:       <span class="m">49152</span> bytes
</span></span><span class="line"><span class="cl">Total number of registers available per block: <span class="m">65536</span>
</span></span><span class="line"><span class="cl">Warp size:                                     <span class="m">32</span>
</span></span><span class="line"><span class="cl">Maximum number of threads per multiprocessor:  <span class="m">2048</span>
</span></span><span class="line"><span class="cl">Maximum number of threads per block:           <span class="m">1024</span>
</span></span><span class="line"><span class="cl">Max dimension size of a thread block <span class="o">(</span>x,y,z<span class="o">)</span>: <span class="o">(</span>1024, 1024, 64<span class="o">)</span>
</span></span><span class="line"><span class="cl">Max dimension size of a grid size    <span class="o">(</span>x,y,z<span class="o">)</span>: <span class="o">(</span>2147483647, 65535, 65535<span class="o">)</span>
</span></span><span class="line"><span class="cl">Maximum memory pitch:                          <span class="m">2147483647</span> bytes
</span></span><span class="line"><span class="cl">Texture alignment:                             <span class="m">512</span> bytes
</span></span><span class="line"><span class="cl">Concurrent copy and kernel execution:          Yes with <span class="m">1</span> copy engine<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">Run <span class="nb">time</span> limit on kernels:                     Yes
</span></span><span class="line"><span class="cl">Integrated GPU sharing Host Memory:            No
</span></span><span class="line"><span class="cl">Support host page-locked memory mapping:       Yes
</span></span><span class="line"><span class="cl">Alignment requirement <span class="k">for</span> Surfaces:            Yes
</span></span><span class="line"><span class="cl">Device has ECC support:                        Disabled
</span></span><span class="line"><span class="cl">Device supports Unified Addressing <span class="o">(</span>UVA<span class="o">)</span>:      Yes
</span></span><span class="line"><span class="cl">Device PCI Domain ID / Bus ID / location ID:   <span class="m">0</span> / <span class="m">1</span> / <span class="m">0</span>
</span></span><span class="line"><span class="cl">Compute Mode:
</span></span><span class="line"><span class="cl">&lt; Default <span class="o">(</span>multiple host threads can use ::cudaSetDevice<span class="o">()</span> with device simultaneously<span class="o">)</span> &gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">deviceQuery, CUDA <span class="nv">Driver</span> <span class="o">=</span> CUDART, CUDA Driver <span class="nv">Version</span> <span class="o">=</span> 9.0, CUDA Runtime <span class="nv">Version</span> <span class="o">=</span> 8.0, <span class="nv">NumDevs</span> <span class="o">=</span> 1, <span class="nv">Device0</span> <span class="o">=</span> GeForce GTX 950M
</span></span><span class="line"><span class="cl"><span class="nv">Result</span> <span class="o">=</span> PASS
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x02-安装-cudnn">0x02 安装 <code>cuDNN</code></h2>
<p>安装教程： <a href="https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html" target="_blank" rel="noopener noreffer">https://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# sudo dpkg -i ~/Downloads/libcudnn7_7.1.4.18-1+cuda8.0_amd64.deb
</span></span><span class="line"><span class="cl">user@machine:~# sudo dpkg -i ~/Downloads/libcudnn7-dev_7.1.4.18-1+cuda8.0_amd64.deb
</span></span><span class="line"><span class="cl">user@machine:~# sudo dpkg -i ~/Downloads/libcudnn7-doc_7.1.4.18-1+cuda8.0_amd64.deb
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="运行-cudnn-测试用例">运行 <code>cuDNN</code> 测试用例</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Copy the cuDNN sample to a writable path.</span>
</span></span><span class="line"><span class="cl">user@machine:~# cp -r /usr/src/cudnn_samples_v7/ <span class="nv">$HOME</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Go to the writable path.</span>
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">cd</span> <span class="nv">$HOME</span>/cudnn_samples_v7/mnistCUDNN
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Compile the mnistCUDNN sample.</span>
</span></span><span class="line"><span class="cl">user@machine:~# make clean <span class="o">&amp;&amp;</span> make
</span></span><span class="line"><span class="cl"><span class="c1"># Run the mnistCUDNN sample. &#39;Test passed!&#39; means cuDNN works.</span>
</span></span><span class="line"><span class="cl">user@machine:~# ./mnistCUDNN
</span></span><span class="line"><span class="cl">……
</span></span><span class="line"><span class="cl">Test passed!
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="故障排除没有-libcudartso80">故障排除：没有 <code>libcudart.so.8.0</code></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./mnistCUDNN: error <span class="k">while</span> loading shared libraries: libcudart.so.8.0: cannot open shared object file: No such file or directory
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解决办法：https://blog.csdn.net/u011636567/article/details/77162217</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 首先检查 /usr/local/cuda-8.0/lib64 目录，看看 libcudart.so.8.0 是否存在，如果不存在，则先正确安装 cuda; 如果确定 cuda 已经存在，这个问题的出现与 Linux 的 ldconfig 命令有关</span>
</span></span><span class="line"><span class="cl">以下两种方法同理： 
</span></span><span class="line"><span class="cl"><span class="c1"># 1.</span>
</span></span><span class="line"><span class="cl">user@machine:~# sudo ldconfig /usr/local/cuda-8.0/lib64 
</span></span><span class="line"><span class="cl"><span class="c1"># 2.</span>
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/cuda-8.0/lib64
</span></span><span class="line"><span class="cl"><span class="c1"># 如果仍然不行，再尝试执行: </span>
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/cuda-8.0/bin 
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">export</span> <span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LIBRARY_PATH</span>:/usr/local/cuda-8.0/lib64 
</span></span><span class="line"><span class="cl">user@machine:~# <span class="nb">source</span> /etc/profile 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x03-在-caffe-中启用-gpu">0x03 在 <code>Caffe</code> 中启用 GPU</h2>
<h3 id="查看-cuda-和-cudnn-版本">查看 <code>CUDA</code> 和 <code>cuDNN</code> 版本：</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># CUDA</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /usr/local/cuda/version.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># if cuDNN was installed from a tar file</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /usr/local/cuda/include/cudnn.h <span class="p">|</span> grep CUDNN_MAJOR -A <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># if cuDNN was installed from a debian file</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /usr/include/cudnn.h <span class="p">|</span> grep CUDNN_MAJOR -A <span class="m">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="切换-caffe-到-cudnn-加速模式并测试运行手写体识别">切换 <code>Caffe</code> 到 <code>cuDNN</code> 加速模式并测试运行手写体识别</h3>
<p>首先修改 <code>Makefile.config</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# sudo vim ~/caffe/Makefile.config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 注释掉仅 CPU 模式开关</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CPU_ONLY := 1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 打开 cuDNN 加速开关</span>
</span></span><span class="line"><span class="cl">USE_CUDNN :<span class="o">=</span> <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后重新编译整个工程（根据输出可以观察到编译的对象是 <code>~/caffe/src/caffe</code> 下的 <code>*.cu</code> 和 <code>*.cpp</code>）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# make clean <span class="o">&amp;&amp;</span> make -j8
</span></span></code></pre></td></tr></table>
</div>
</div><p>在运行时启用 GPU 有两种方式:</p>
<ol>
<li>运行 MNIST 例程前，修改训练超参数文件：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# sudo vim examples/mnist/lenet_solver.prototxt
</span></span><span class="line"><span class="cl"><span class="c1"># 改 CPU 为 GPU</span>
</span></span><span class="line"><span class="cl">solver_mode: GPU
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#   运行 MNIST 识别程序</span>
</span></span><span class="line"><span class="cl">user@machine:~# ./examples/mnist/train_lenet.sh
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>运行时使用参数指定 GPU 执行</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# ./examples/mnist/train_lenet.sh -gpu <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x04-补充确认-make-编译时调用的-gpu-核数">0x04 补充：确认 <code>make</code> 编译时调用的 GPU 核数</h2>
<blockquote>
<p><code>总核数</code> = <code>物理 CPU 个数</code> X <code>每颗物理 CPU 的核数</code></p>
<p><code>总逻辑 CPU 数</code> = <code>物理 CPU 个数</code> X <code>每颗物理 CPU 的核数</code> X <code>超线程数</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看物理 CPU 个数</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /proc/cpuinfo<span class="p">|</span> grep <span class="s2">&#34;physical id&#34;</span><span class="p">|</span> sort<span class="p">|</span> uniq<span class="p">|</span> wc -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看每个物理 CPU 中 core 的个数（即核数）</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /proc/cpuinfo<span class="p">|</span> grep <span class="s2">&#34;cpu cores&#34;</span><span class="p">|</span> uniq
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看逻辑 CPU 的个数</span>
</span></span><span class="line"><span class="cl">user@machine:~# cat /proc/cpuinfo<span class="p">|</span> grep <span class="s2">&#34;processor&#34;</span><span class="p">|</span> wc -l
</span></span><span class="line"><span class="cl"><span class="m">16</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make 的时候就可以 make -j16</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="0x05-补充监测-gpu-运行情况">0x05 补充：监测 GPU 运行情况</h2>
<ul>
<li>第三方工具：<a href="ttps://github.com/mountassir/gmonitor/releases" target="_blank" rel="noopener noreffer">gmonitor</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">user@machine:~# tar xvzf gmonitor-v1.3.tar.gz
</span></span><span class="line"><span class="cl">user@machine:~# sudo cp ~/Downloads/gmonitor /usr/local/bin/
</span></span><span class="line"><span class="cl">user@machine:~# gmonitor
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>官方工具：nvidia-smi（安装完显卡驱动后自带）
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 每10s刷新一次</span>
</span></span><span class="line"><span class="cl">user@machine:~# watch -n <span class="m">10</span> nvidia-smi
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
]]></description></item><item><title>如何在 Ubuntu 上安装深度截图</title><link>https://xuchunqiu.me/install-deepin-screenshot-on-ubuntu/</link><pubDate>Mon, 25 Feb 2019 09:11:06 +0000</pubDate><author>Author</author><guid>https://xuchunqiu.me/install-deepin-screenshot-on-ubuntu/</guid><description><![CDATA[<h1 id="update">Update</h1>
<p>深度截图目前已有 <a href="https://www.deepin.org/zh/original/deepin-screenshot/" target="_blank" rel="noopener noreffer">官方介绍</a>、<a href="https://wiki.deepin.org/wiki/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE" target="_blank" rel="noopener noreffer">使用说明</a>，但依然没有提供从深度商店外安装深度截图的教程。</p>
<p>appimage 格式深度截图的下载地址已经失效，但依然可以从互联网档案馆上 <a href="https://web.archive.org/web/20201120043221/https://github-production-release-asset-2e65be.s3.amazonaws.com/110259696/6110e818-0909-11e8-92a8-e734dc188fe0?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20201120%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20201120T043221Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=134866f6be04ad00a4eaf1a2aa00604d5fbfd4fe5f9597a94a2a92da3d758053&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;key_id=0&amp;repo_id=110259696&amp;response-content-disposition=attachment%3B%20filename%3DDeepin_Screenshot_4.0.10.4-x86_64.AppImage&amp;response-content-type=application%2Foctet-stream" target="_blank" rel="noopener noreffer">下载（35.7 MB）</a>。</p>
<h2 id="1-下载深度截图">1. 下载深度截图</h2>
<p>从以下地址下载第三方打包的深度截图：</p>
<p><del><a href="https://github.com/ZetaoYang/deepin-app-package/releases" target="_blank" rel="noopener noreffer">https://github.com/ZetaoYang/deepin-app-package/releases</a></del></p>
<h2 id="2-运行">2. 运行</h2>
<p>首先添加执行权限</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod +x ./Deepin_Screenshot-x86_64.AppImage
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用方法：</p>
<ul>
<li>GUI： 文件管理器双击</li>
<li>CLI：<code>~/Downloads/Deepin_Screenshot_4.0.10.4-x86_64.AppImage</code></li>
</ul>
<h2 id="3-让深度截图在-ubuntu-启动台显示">3. 让深度截图在 Ubuntu 启动台显示</h2>
<h3 id="31-appimagelauncher-法"><del>3.1 AppImageLauncher 法</del></h3>
<p>AppImageLauncher 顾名思义是一个可以快速把 appimage 软件加入启动台的工具。只需要从 <a href="https://github.com/TheAssassin/AppImageLauncher/releases" target="_blank" rel="noopener noreffer">https://github.com/TheAssassin/AppImageLauncher/releases</a> 下载的合适版本，然后执行以下命令安装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dpkg -i ~/Downloads/appimagelauncher_1.0.3-travis508.git20190223.0c6d768_amd64.deb
</span></span></code></pre></td></tr></table>
</div>
</div><p>理论上再次双击之前的 Deepin_Screenshot_4.0.10.4-x86_64.AppImage 就可以初始化 AppImageLauncher，进而可以把 Deepin_Screenshot_4.0.10.4-x86_64.AppImage 显示在 LaunchPad。不幸的是我双击后遇到闪退。</p>
<h3 id="32-手动法">3.2 手动法</h3>
<p>此方法适用于所有只能命令行启动的程序，只需要在 /usr/share/applications/ 下添加一个配置文件就能让程序显示在 Ubuntu 启动台上。但在开始之前，为了美观还需要一个合适的图标，我是从 <a href="http://appstore.deepin.com/data/v1/workaround/metadata/deepin-screenshot/meta/icons/deepin-screenshot.svg" target="_blank" rel="noopener noreffer">http://appstore.deepin.com/data/v1/workaround/metadata/deepin-screenshot/meta/icons/deepin-screenshot.svg</a> 下载图标，然后用在线工具转为PNG格式备用。</p>
<p>按照 <a href="https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E6%A0%87%E5%87%86" target="_blank" rel="noopener noreffer">文件系统层次结构标准</a> 为深度截图在 <code>/opt</code> 下创建目录：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo mkdir /opt/deepinscreenshot
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后把 appimage 程序和 PNG 格式的图标复制进去：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cp ~/Downloads/Deepin_Screenshot_4.0.10.4-x86_64.AppImage /opt/deepinscreenshot/
</span></span><span class="line"><span class="cl">sudo cp ~/Downloads/deepin-screenshot-24px.png /opt/deepinscreenshot/
</span></span></code></pre></td></tr></table>
</div>
</div><p><del>注入灵魂</del> 注册应用程序到启动台：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo vim /usr/share/applications/biubiubiu.desktop
</span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>biubiubiu.desktop 的内容示例<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Desktop Entry]
</span></span><span class="line"><span class="cl">Name=biubiubiu
</span></span><span class="line"><span class="cl">Name[zh_CN]=深度截图
</span></span><span class="line"><span class="cl">Exec=/opt/deepinscreenshot/Deepin_Screenshot_4.0.10.4-x86_64.AppImage
</span></span><span class="line"><span class="cl">Icon=/opt/deepinscreenshot/deepin-screenshot-24px.png
</span></span><span class="line"><span class="cl">Terminal=false
</span></span><span class="line"><span class="cl">X-MultipleArgs=false
</span></span><span class="line"><span class="cl">Type=Application
</span></span><span class="line"><span class="cl">Encoding=UTF-8
</span></span><span class="line"><span class="cl">Categories=Application;
</span></span><span class="line"><span class="cl">StartupNotify=false
</span></span></code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<p>然后就可以在 LaunchPad 看到图标了，鼠标拖拽即可固定到 dock 栏。</p>
]]></description></item></channel></rss>